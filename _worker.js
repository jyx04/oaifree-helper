addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request));
});
 // @ts-ignore
 const KV =oai_global_variables;
 const logo = 'data:image/png;base64,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';
 
 
 //通用函数


 function parseJwt(token) {
  const base64Url = token.split('.')[1];// 获取载荷部分
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
  return JSON.parse(jsonPayload);// 返回载荷解析后的 JSON 对象
}

//刷新AT
async function refreshAT(tochecktoken,an) {
  // 检查 token 是否存在，如果不存在或为空字符串，直接返回 true  
  const accessTokenKey = `at_${an}`;
const token = tochecktoken || await KV.get(accessTokenKey) ||'';
if (token && token !== "Bad_RT" && token !== "Old_AT")
{
 const payload = parseJwt(token);
const currentTime = Math.floor(Date.now() / 1000);// 获取当前时间戳（秒）
if (payload.exp > currentTime ){
  return token
}
}
  const refreshTokenKey = `rt_${an}`;
  const url = 'https://token.oaifree.com/api/auth/refresh';
 const refreshToken = await KV.get(refreshTokenKey);
 if (refreshToken) {
  // 发送 POST 请求
 const response = await fetch(url, {
     method: 'POST',
     headers: {
         'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
     },
     body: `refresh_token=${refreshToken}`
 });

 // 检查响应状态
   if (response.ok) {
     const data = await response.json();
     const newAccessToken = data.access_token;
     await KV.put(accessTokenKey, newAccessToken);
     return newAccessToken;
     } else {
     await KV.put(accessTokenKey, "Bad_RT");
     return '';
      }
} 
else {
  await KV.put(accessTokenKey, "Old_AT");
  return '';
}
}


    // 使用哈希函数加密username
function generatePassword(token) {
  let hash = 7
  for (let i = 0; i < token.length; i++) {
    const char = token.charCodeAt(i)
    hash = (hash << 5) - hash + char
    hash = hash & hash // Convert to 32bit integer
  }
  // 将哈希值转换为正数，并转换为字符串
  let hashStr = Math.abs(hash).toString()
  // 如果 hashStr 长度不足 10 位，用 '7' 填充
  while (hashStr.length < 15) {
    hashStr = '7' + hashStr
  }
  // 截取前15位作为密码
  //const passwd = hashStr.substring(0, 15);
  //console.log(`userName: ${token}, Password: ${passwd},`);
  return hashStr.substring(0, 15)
}
async function verifyTurnstile(responseToken) {
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  if (removeTurnstile){return 'true'}
  const verifyUrl = 'https://challenges.cloudflare.com/turnstile/v0/siteverify';
  const secretKey = await KV.get('TurnstileKeys');
  const response = await fetch(verifyUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      secret: secretKey,
      response: responseToken
    })
  });
  const data = await response.json();
  return data.success;
}
async function usermatch(userName, usertype) {
  const typeUsers = await KV.get(usertype)  || '';
  const typeUsersArray = typeUsers.split(","); // 将返回的用户类型字符串分割成数组
  return typeUsersArray.includes(userName); // 检查用户名是否在类型用户数组中
}

// 使用 OpenAI 的道德审核接口检查内容
async function checkContentForModeration(messages, apiKey) {
  const response = await fetch("https://api.oaipro.com/v1/moderations", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${apiKey}`,
    },
    body: JSON.stringify({ input: messages }),
  });
  // 检查 HTTP 响应是否成功
  if (response.ok) {
    // response.ok 是一个便捷属性，当状态码在 200-299 范围内时为 true
    const data = await response.json();
    return {
      shouldBlock: data.results.some((result) => result.flagged),
    };
  } else {
    console.error("Moderation API returned an error:", response.status);
    return { shouldBlock: false }; // 如果 API 调用失败，假定内容是安全的
  }
}


//各种路径的功能
async function handleRequest(request) {
  const url = new URL(request.url);
  const voiceURL = await KV.get('VoiceURL');
  const admin = await KV.get('Admin');
  const chatlogourl = await KV.get('ChatLogoURL') || await KV.get('LogoURL') || logo;
  const chatusername = await KV.get('ChatUserName') || 'Haibara AI';
  const chatmail = await KV.get('ChatMail') || 'Power by Pandora';
  const apiKey = await KV.get('ModerationApiKey');
  const moderationFree = await KV.get('ModerationFree');
   const cookies = request.headers.get('Cookie');
  let aian = '';
  let fullUserName = "";
    if (cookies) {
      const cookiesArray = cookies.split(";");
      for (const cookie of cookiesArray) {
        const [name, value] = cookie.trim().split("=");
        if (name === "aian") {
          aian = value;
        }
        if (name === "userName") {
          fullUserName = value;
        }
      }
    }
  
  //处理直链登陆形式
  const params = new URLSearchParams(url.search);
  const userName = params.get('un');
  if (userName) {
      const accountNumber = params.get('an-custom') || params.get('an') || '1';
      return await handleLogin(userName, accountNumber, 'do not need Turnstle','');
  }

  if (!admin){
      return handleInitialRequest(request);
  }

  if (url.pathname.startsWith('/admin')) {
    if (request.method === 'GET') {
      return handleAdminGetRequest();
    } else if (request.method === 'POST') {
      return handleAdminPostRequest(request);
    } else {
      return new Response('Method not allowed', { status: 405 });
    }
  }

  if (url.pathname.startsWith('/token')) {
    if (request.method === 'GET') {
      return handlePlusGetRequest();
    } else if (request.method === 'POST') {
      return handlePlusPostRequest(request);
    } else {
      return new Response('Method not allowed', { status: 405 });
    }
  }

  if(url.pathname.startsWith('/export')){
    if (request.method === 'GET') {
      return handleExportGetRequest(request);
    }  else if (request.method === 'POST') {
      return handleExportPostRequest(request);
    }else {
      return new Response('Method not allowed', { status: 405 });
    }
   }
  if (url.pathname.startsWith('/user')) {
    if (request.method === 'GET') {
      return handleUserGetRequest();
    } else if (request.method === 'POST') {
      return handleUserPostRequest(request);
    } else {
      return new Response('Method not allowed', { status: 405 });
    }
  }

  if (url.pathname.startsWith('/register')) {
    if (request.method === 'GET') {
      return new Response(await getRegisterHTML(), {
        headers: { 'content-type': 'text/html' },
      });
    } else if (request.method === 'POST') {
      return handleRegisterPostRequest(request);
    } else {
      return new Response('Method not allowed', { status: 405 });
    }
  }

 if(url.pathname.startsWith('/usage')){
  return handleUsageRequest(request)
 }

 
  // for oaifree
  if (url.pathname === '/auth/login_auth0') {
    if (request.method === 'GET') {
      return handleLoginGetRequest(request);
    } else if (request.method === 'POST') {
      return handleLoginPostRequest(request);
    } else {
      return new Response('Method not allowed', { status: 200 });
    }
  }

  if (url.pathname === '/auth/login') {
    /*  const token = url.searchParams.get('token');
    if (!token) {
       if (request.method === 'GET') {
         return handleLoginGetRequest(request);
       } else if (request.method === 'POST') {
         return handleLoginPostRequest(request);
       } else {
         return new Response('Method not allowed', { status: 200 });
       }
     } */
     url.host = 'new.oaifree.com';
     url.protocol = 'https';
     return fetch(new Request(url, request));
   }

  if(fullUserName !== moderationFree){
      if (apiKey) {
        if (url.pathname === "/backend-api/conversation") {
          const requestBody = await request.json();
          const userMessages = requestBody.messages.filter(
            (msg) => msg.author.role === "user" && msg.content.content_type === "text"
          ).map((msg) => msg.content.parts.join(" "));
          if (userMessages.length > 0) {
            const moderationResult = await checkContentForModeration(
              userMessages,
              apiKey
            );
            if (moderationResult.shouldBlock) {
              const UserName = userMessages;
              await deletelog(UserName, aian, "Message");
              return new Response(
                JSON.stringify({ detail: "\u6B64\u5185\u5BB9\u53EF\u80FD\u8FDD\u53CD\u4E86\u6211\u4EEC\u7684\u4F7F\u7528\u653F\u7B56" }),
                {
                  status: 451,
                  headers: { "Content-Type": "application/json" }
                }
              );
            }
          }
          url.host = "new.oaifree.com";
          const newnewRequest = new Request(url, {
            body: JSON.stringify(requestBody),
            method: request.method,
            headers: request.headers
          });
          return fetch(newnewRequest);
        }
      }
    }
  
  //Voice地址和其他
 url.host = 'new.oaifree.com';
 const modifiedRequest = new Request(url, request);
 if(voiceURL){
 modifiedRequest.headers.set('X-Voice-Base', `https://${voiceURL}`);
 }
 const response = await fetch(modifiedRequest);

 //去掉小锁
 if (url.pathname === '/backend-api/conversations') {
   const data = await response.json();
   data.items = data.items.filter(item => item.title !== "🔒");
   return new Response(JSON.stringify(data), {
     status: response.status,
     headers: response.headers
   });
 }
 
 //修改用户信息
 if (url.pathname === '/backend-api/me') {
   const data = await response.json();
   data.picture = `${chatlogourl}`;
   data.email = `${chatmail}`;
   data.name = `${chatusername} [${aian}]`;
   return new Response(JSON.stringify(data), {
     status: response.status,
     headers: response.headers
   });
 }
 if (url.pathname === '/backend-api/gizmo_creator_profile') {
   const data = await response.json();
   data.name = `${chatusername} [${aian}]`;
   data.display_name = `${chatusername} [${aian}]`;
   return new Response(JSON.stringify(data), {
     status: response.status,
     headers: response.headers
   });
 }
   return response;
}


//初始化信息填入功能
async function handleInitialRequest(request) {
  const admin = await KV.get('Admin');
if (!admin){
  if (request.method === 'GET') {
    return handleInitialGetRequest();
  } else if (request.method === 'POST') {
    return handleInitialPostRequest(request);
  } else {
    return new Response('Method not allowed', { status: 405 });
  }
}
else {return new Response('Already Have Admin', { status: 405 });
}
}

async function handleInitialPostRequest(request) {
  const formData = await request.formData();
  const fields = [
    'TurnstileKeys', 'TurnstileSiteKey', 'Users', 'VIPUsers', 'FreeUsers', 
    'Admin', 'ForceAN', 'SetAN', 'PlusMode', 'FreeMode', 'WebName', 
    'WorkerURL','VoiceURL', 'LogoURL', 'CDKEY', 'AutoDeleteCDK', 'FKDomain', 'Status',
    'PlusAliveAccounts', 'FreeAliveAccounts', 'rt_1', 'rt_2', 'at_1', 'at_2', 'FreeURL', 'ChatUserName', 'ChatMail', 'ChatLogoURL', 'RemoveTurnstile','ModerationApiKey','ModerationFree'
  ];

  for (const field of fields) {
        let value = formData.get(field);
        if (value) { // 确保字段有值再保存
            if (field === 'WorkerURL' && !value) {
                value = (new URL(request.url)).hostname;
            }
            if (field === 'VoiceURL' && !value) {
                let hostname = (new URL(request.url)).hostname;
                let parts = hostname.split('.');
                parts[0] = 'voice';
                value = parts.join('.');
            }
            if (field === 'FreeURL' && !value) {
                let hostname = (new URL(request.url)).hostname;
                let parts = hostname.split('.');
                parts[0] = 'free';
                value = parts.join('.');
            }
            await KV.put(field, value); // 保存到KV存储
        }
    }

  return new Response('Parameters updated successfully', { status: 200 });
}

async function handleInitialGetRequest() {
  const html = await getInitialHTML();
  return new Response(html, { headers: { 'Content-Type': 'text/html' } });
}

async function getInitialHTML() {
  return `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Variable Shortcut Entry</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f2f2f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        overflow: hidden;
      }
      .container {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        width: 100%;
        height: 90vh;
        overflow-y: auto;
        box-sizing: border-box;
      }
      .container h1 {
        margin-bottom: 24px;
        font-size: 28px;
        color: #333;
        font-weight: 600;
      }
      .container label {
        display: block;
        font-size: 16px;
        margin-bottom: 8px;
        color: #555;
        text-align: left;
      }
      .container input {
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        width: 100%;
        margin-bottom: 20px;
      }
      .container button {
        background-color: #007aff;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s;
        padding: 12px;
        border-radius: 8px;
        width: 100%;
      }
      .container button:hover {
        background-color: #005fcb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Variable Shortcut Entry</h1>
      <form id="variableEntryForm" action="/" method="POST">
        ${getInitialFieldsHTML()}
        <button type="submit">Submit</button>
      </form>
    </div>
  </body>
  </html>
`;
}

function getInitialFieldsHTML() {
  const fields = [
    { name: 'Admin', label: '【必填】管理员 (用于管理面板的验证使用，且可看所有聊天记录)' ,isrequired: 'required'},
    { name: 'TurnstileKeys', label: '【必填】Turnstile密钥' ,isrequired: 'required'},
    { name: 'TurnstileSiteKey', label: '【必填】Turnstile站点密钥' ,isrequired: 'required'},
    { name: 'Remove Turnstile', label: '【选填】有值则禁用Turnstile验证，以上两个参数随意' },
    { name: 'ModerationApiKey', label: '【选填】如需启用道德审查，则填入始皇oaipro的apikey' },
    { name: 'ModerationFree', label: '【选填】如需启用道德审查，道德审查豁免用户' },
    { name: 'WorkerURL', label: '站点域名 (无需https://【选填，不填则自动储存worker的域名】' },
    { name: 'VoiceURL', label: 'voice服务域名 (无需https://【选填，不填则自动储存worker的域名】' },
    { name: 'FreeURL', label: 'Free选车面板域名 (无需https://【选填，不填则自动储存worker的域名】' },
    { name: 'WebName', label: '站点名称' },
    { name: 'LogoURL', label: 'Logo图片地址 (需https://)' },
    { name: 'ChatLogoURL', label: 'chat界面用户头像地址(需https://)' },
    { name: 'ChatUserName', label: 'chat界面用户名 (需https://)' },
    { name: 'ChatMail', label: 'chat界面用户邮箱 (需https://)' },
    { name: 'Users', label: '默认用户 (以aaa,bbb,ccc形式填写)' },
    { name: 'VIPUsers', label: 'VIP用户 (即私车用户，无速率和时间限制)' },
    { name: 'FreeUsers', label: '免费用户 (有速率和时间限制)' },
    { name: 'ForceAN', label: '强制上车 (若设置为1，用户名为xxx_n的私车用户用登陆强制进入n号车，忽略登陆所选车号)' },
    { name: 'SetAN', label: '选车模式：(如只有一辆车则填1。登陆页手动选车则留空。如开启随机或顺序轮询，填True，并用下面两个变量控制)' },
    { name: 'PlusMode', label: 'Plus号随机的轮询方式 (Order或者Random)' },
    { name: 'FreeMode', label: '普号随机的轮询方式 (Order/Random。如填Plus则使用Plus号池)' },
    { name: 'CDKEY', label: '注册可用的激活码 (以aaa,bbb,ccc格式)' },
    { name: 'AutoDeleteCDK', label: '设置为1激活码只可用一次' },
    { name: 'FKDomain', label: '把sharetoken当at用时，指定反代域名' },
    { name: 'Status', label: '服务状态 (若为非空，无视openai官方故障通告，始终允许登陆)' },
    { name: 'PlusAliveAccounts', label: 'plus号池存活序号 (以1,2,3格式)【可不填，录入账号后自动填】' },
    { name: 'FreeAliveAccounts', label: '普号存活序号 (以1,2,3格式)【可不填，录入账号后自动填】' },
    { name: 'rt_1', label: 'rt_1【可不填，录入账号后自动填】' },
    { name: 'at_1', label: 'at_1 (若已有rt，at可不填)【可不填，录入账号后自动填】' },
  ];

  return fields.map(field => `
    <label for="${field.name}">${field.label}</label>
    <input type="text" id="${field.name}" name="${field.name}" ${field.isrequired}>
  `).join('');
}



//Token管理功能
async function handlePlusPostRequest(request) {
  const formData = await request.formData();
  const adminuserName = formData.get('adminusername');
  const refreshToken = formData.get('refresh_token');
  const accountNumber = formData.get('account_number');
  const accountUsers = formData.get('account_users'); 
  const turnstileResponse = formData.get('cf-turnstile-response');

  // 验证 Turnstile 响应
  if (!turnstileResponse || !await verifyTurnstile(turnstileResponse)) {
    return generatePlusResponse('Turnstile verification failed', adminuserName);
  }

  // 检查参数是否存在
  if (!adminuserName || !refreshToken || !accountNumber) {
    return generatePlusResponse(`Missing parameters: ${!adminuserName ? 'adminusername ' : ''}${!refreshToken ? 'refresh_token ' : ''}${!accountNumber ? 'account_number ' : ''}`, adminuserName);
  }

  // 获取 adminusers 列表
  const adminusers = await KV.get('Admin');
  if (!adminusers) {
    return new Response('Done', { status: 200 });
  }

  // 检查用户名是否存在于 adminusers 列表中
  if (!adminusers.split(',').includes(adminuserName)) {
    return generatePlusResponse('Unauthorized access.', adminuserName);
  }


  // 更新跟车 users
  if (accountUsers) {
    // 获取当前 users 数据并更新
    const currentUsers = await KV.get('VIPUsers');
    const newUsers = accountUsers.split(',').map(vipuser => `${vipuser}_${accountNumber}`).join(',');
    const updatedUsers = `${currentUsers},${newUsers}`;
    await KV.put('VIPUsers', updatedUsers);
  }

  // 处理 JSON 格式的 refreshToken
  let jsonAccessToken, jsonRefreshToken;
  try {
    const tokenData = JSON.parse(refreshToken);
    const rtKey = `rt_${accountNumber}`;
    const atKey = `at_${accountNumber}`;
    if (tokenData.access_token) {
      jsonAccessToken = tokenData.access_token;
      jsonRefreshToken = tokenData.refresh_token ||'';
      await KV.put(atKey, jsonAccessToken);
      await KV.put(rtKey, jsonRefreshToken);
      await addToAliveAccountList(jsonAccessToken, accountNumber);
      return generatePlusResponse(`account_number:\n${accountNumber}\n\nrefresh_token:\n${jsonRefreshToken}\n\naccess_token:\n${jsonAccessToken}`, adminuserName);
    } else if (tokenData.accessToken) {
      jsonAccessToken = tokenData.accessToken;
      jsonRefreshToken = '';
      await KV.put(atKey, jsonAccessToken);
      await KV.put(rtKey, jsonRefreshToken);
      await addToAliveAccountList(jsonAccessToken, accountNumber);
      return generatePlusResponse(`account_number:\n${accountNumber}\n\nrefresh_token:\n${jsonRefreshToken}\n\naccess_token:\n${jsonAccessToken}`, adminuserName);
    }
 //   const result = await processToken(refreshToken, accountNumber, adminuserName);
 // return result;

  } catch (e) {
    // 输入不是 JSON 格式
  }

  

  // 批量处理非 JSON 格式的 token
  if (!jsonAccessToken && refreshToken.includes(',')) {
    const tokens = refreshToken.split(',');
    let currentAccountNumber = parseInt(accountNumber);

    for (const token of tokens) {
      const result = await processToken(token.trim(), currentAccountNumber, adminuserName);
      currentAccountNumber++;
    }

    return generatePlusResponse('Batch processing completed.', adminuserName);
  }

  // 单个 token 处理
  const result = await processToken(refreshToken, accountNumber, adminuserName);
  return result;
}

async function processToken(token, accountNumber, adminuserName) {
  // 更新 KV 库
  const rtKey = `rt_${accountNumber}`;
  const atKey = `at_${accountNumber}`;

  // 使用st
  if (token.startsWith('fk-')) {
    await KV.put(atKey, token);
    await addToAliveAccountList('', accountNumber);

    return generatePlusResponse(`Share token stored directly`, adminuserName);
  }

  // rt 长度检查,如果大于 50,则视为 at 则不请求新的 access token
  if (token.length > 50) {
    await KV.put(atKey, token);
    await addToAliveAccountList(token, accountNumber);

    return generatePlusResponse(`Access token stored directly`, adminuserName);
  }

  const url = 'https://token.oaifree.com/api/auth/refresh';

  // 发送 POST 请求
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
    },
    body: `refresh_token=${token}`
  });

  // 检查响应状态
  if (response.ok) {
    const data = await response.json();
    const newAccessToken = data.access_token;

    // 更新两个 token
    await KV.put(atKey, newAccessToken);
    await KV.put(rtKey, token);
    await addToAliveAccountList(newAccessToken, accountNumber);

    return generatePlusResponse(`account_number:\n${accountNumber}\n\nrefresh_token:\n${token}\n\naccess_token:\n${newAccessToken}`, adminuserName);
  } else {
    return generatePlusResponse('Error fetching access token, Bad refresh token.', adminuserName);
  }
}

async function handlePlusGetRequest() {
  const html = await getPlusHTML();
  return new Response(html, { headers: { 'Content-Type': 'text/html' } });
}

async function checkAccountType(access_token) {
  // 构建 API 请求
  const apiRequest = new Request('https://api.oaifree.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${access_token}`
    },
    body: JSON.stringify({
      "model": "gpt-3.5-turbo",
      "messages": [
        { "role": "user", "content": "hi" }
      ],
      "max_tokens": 1
    })
  });

  try {
    // 发送 API 请求并获取响应
    const apiResponse = await fetch(apiRequest);
    // 记录响应状态
    if (apiResponse.status === 401) { // 普号 / sharetoken / 失效账号
      return 'Free';
    } else {
      return 'Plus'; // 正常返回的 plus 号
    }
  } catch (error) {
    // 错误处理
  }
}

async function addToAliveAccountList(accessToken, accountNumber) {
  // 获取当前的 aliveaccount 并更新
  const accountType = await checkAccountType(accessToken);
  const aliveAccountsKey = `${accountType}AliveAccounts`;

  let aliveAccount = await KV.get(aliveAccountsKey);
  let aliveAccountList = aliveAccount ? aliveAccount.split(',') : [];
  if (!aliveAccountList.includes(accountNumber)) {
    aliveAccountList.push(accountNumber);
    await KV.put(aliveAccountsKey, aliveAccountList.join(','));
  }
}

async function generatePlusResponse(message, adminuserName) {
  const errorHtml = `
    <div class="ulp-field ulp-error">
      <div class="ulp-error-info">
        <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
        ${message}
      </div>
    </div>
  `;

  const replacements = [
    { target: '<button type="submit">Submit</button>', replacement: errorHtml + '<button class="continue-btn" type="submit">Continue</button>' },
    { target: '<input type="password" id="adminsername" name="adminusername" required>', replacement: `<input type="password" id="adminsername" name="adminusername" value="${adminuserName}" required>` },
  ];

  const html = await getPlusHTML();

  let responseHtml = html;
  for (const { target, replacement } of replacements) {
    responseHtml = responseHtml.replace(target, replacement);
  }

  return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
}

async function getPlusHTML() {
  const WorkerURL = await KV.get('WorkerURL');
  const turnstileSiteKey = await KV.get('TurnstileSiteKey');
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Token Management</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f2f2f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
    }
    .login-container {
      background-color: #ffffff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .login-container h1 {
      margin-bottom: 24px;
      font-size: 28px;
      color: #333;
      font-weight: 600;
    }
    .login-container label {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
      color: #555;
      text-align: left;
    }
    .login-container input {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      width: 100%;
      margin-bottom: 20px;
    }
    .login-container .button-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .login-container .button-container .row {
      display: flex;
      gap: 10px;
    }
    .login-container button {
      padding: 12px;
      background-color: #007aff;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s;
      flex: 1;
    }
    .login-container button:hover {
      background-color: #005fcb;
    }
    .ulp-field.ulp-error .ulp-error-info {
      margin-top: 4px;
      margin-bottom: 4px;
      display: flex;
      font-size: 10px;
      line-height: 1;
      text-align: left;
      color: #d00e17;
    }
    .ulp-input-error-icon {
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <h1>Token Management</h1>
    <form id="managePlus" action="/token" method="POST">
      <label for="adminusername">Admin Username:</label>
      <input type="password" id="adminsername" name="adminusername" required>
      <label for="refresh_token">RT/AT:</label>
      <input type="text" id="refresh_token" name="refresh_token" required>
      <label for="account_number">Account Number:</label>
      <input type="number" id="account_number" name="account_number" required>
      <label for="account_users">Account Users:</label>
      <input type="text" id="account_users" name="account_users">
      <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
      <div class="button-container">
        <button type="submit">Submit</button>
        <div class="row">
          <button type="button" onclick="window.location.href='https://token.oaifree.com/auth'">Get Token</button>
          <button type="button" onclick="window.location.href='https://${WorkerURL}'">Go Login</button>
        </div>
      </div>
      <div style="height: 20px;"></div>
      <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
    </form>
  </div>
  <script>
  if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }

  function onTurnstileCallback(token) {
    document.getElementById('cf-turnstile-response').value = token;
  }

  document.getElementById('managePlus').addEventListener('submit', function(event) {
    if (!document.getElementById('cf-turnstile-response').value) {
      alert('Please complete the verification.');
      event.preventDefault();
    }
  });
  </script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</body>
</html>
`;
}


//token export功能
async function handleExportGetRequest(request) {
  const url = new URL(request.url);
  const adminUserName = url.searchParams.get('admin');
  const tokenType = url.searchParams.get('token');
  const accountType = url.searchParams.get('type');
  if (!adminUserName || !tokenType || !accountType) {
    const html = await getExportHTML();
    return new Response(html, { headers: { 'Content-Type': 'text/html' } });
  }
  const adminusers = await KV.get('Admin') || '';
  if (adminusers.split(',').includes(adminUserName)) {
  const validTokenTypes = ['rt', 'at'];
  const validAccountTypes = ['Free', 'Plus'];
  if (!validTokenTypes.includes(tokenType) || !validAccountTypes.includes(accountType)) {
    return new Response('Invalid token or account type', { status: 400 });
  }
  return await exportToken(tokenType, accountType);
}
else{return new Response('Unauthorized access', { status: 403 });
}
}

async function exportToken(tokenType, accountType) {
  const accountTypeKey = `${accountType}AliveAccounts`;

  // 获取对应类型的账户列表
  let aliveAccount = await KV.get(accountTypeKey);
  if (!aliveAccount) {
    return new Response('No accounts found', { status: 404 });
  }

  let accountNumbers = aliveAccount.split(',');
  let tokens = [];

  // 分批次处理账户，假设每批次处理 10 个账户
  const batchSize = 10;
  for (let i = 0; i < accountNumbers.length; i += batchSize) {
    const batch = accountNumbers.slice(i, i + batchSize);

    // 使用 Promise.all 并行处理
    const batchTokens = await Promise.all(batch.map(async (accountNumber) => {
      if (tokenType == 'at') {
        return await refreshAT('', accountNumber);
      } else {
        let rtKey = `${tokenType}_${accountNumber}`;
        return await KV.get(rtKey);
      }
    }));

    tokens.push(...batchTokens);
  }

  // 创建 txt 文件
  let fileContent = tokens.join('\n');
  let fileName = `${tokenType}.txt`;

  // 创建文件响应
  return new Response(fileContent, {
    headers: {
      'Content-Type': 'text/plain',
      'Content-Disposition': `attachment; filename=${fileName}`
    }
  });
}
async function handleExportPostRequest(request) {
  const formData = await request.formData();
  const adminPassword = formData.get('adminpassword');
  const tokenType = formData.get('token_type');
  const accountType = formData.get('account_type');
  const operationType = formData.get('operation_type');
  const turnstileResponse = formData.get('cf-turnstile-response');

  // 验证 Turnstile 响应
  if (!turnstileResponse || !await verifyTurnstile(turnstileResponse)) {
    return new Response('Turnstile verification failed', { status: 403 });
  }

  // 获取 adminusers 列表
  const adminusers = await KV.get('Admin');
  if (!adminusers) {
    return new Response('Admin list is empty', { status: 500 });
  }

  // 检查管理员密码是否正确
  if (adminusers.split(',').includes(adminPassword)) {
   
  if (operationType=='txt'){
  // 验证 tokenType 和 accountType 是否有效
  const validTokenTypes = ['rt', 'at'];
  const validAccountTypes = ['Free', 'Plus'];
  if (!validTokenTypes.includes(tokenType) || !validAccountTypes.includes(accountType)) {
    return new Response('Invalid token or account type', { status: 400 });
  }

  // 调用 exportToken 函数并返回结果
  return await exportToken(tokenType, accountType);}
  else{
    const WorkerURL=await KV.get('WorkerURL');
    return new Response(`https://${WorkerURL}/export?admin=${adminPassword}&type=${accountType}&token=${tokenType}`, { status: 200 });
  }
}

else {return new Response('Unauthorized access', { status: 403 });
}
}


async function getExportHTML() {
  const turnstileSiteKey = await KV.get('TurnstileSiteKey');
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  return `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Export Tokens</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f2f2f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
      }
      .export-container {
        background-color: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        text-align: center;
      }
      .export-container h1 {
        margin-bottom: 24px;
        font-size: 28px;
        color: #333;
        font-weight: 600;
      }
      .export-container label {
        display: block;
        font-size: 16px;
        margin-bottom: 8px;
        color: #555;
        text-align: left;
      }
      .export-container input, .export-container select {
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        width: 100%;
        margin-bottom: 20px;
        height: 48px;
      }
      .export-container button {
        padding: 12px;
        background-color: #007aff;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .export-container button:hover {
        background-color: #005fcb;
      }
    </style>
  </head>
  <body>
    <div class="export-container">
      <h1>Export Tokens</h1>
      <form id="exportTokens" action="/export" method="POST">
        <label for="adminpassword">Admin Password:</label>
        <input type="password" id="adminpassword" name="adminpassword" required>
        <label for="token_type">Token Type:</label>
        <select id="token_type" name="token_type" required>
          <option value="rt">Refresh Token</option>
          <option value="at">Access Token</option>
        </select>
        <label for="account_type">Account Type:</label>
        <select id="account_type" name="account_type" required>
          <option value="Free">Free</option>
          <option value="Plus">Plus</option>
        </select>
        <label for="operation_type">Operation Type:</label>
        <select id="operation_type" name="operation_type" required>
          <option value="txt">Download TXT</option>
          <option value="link">Generate Link</option>
        </select>
        <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
        <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
        <button type="submit">Export</button>
      </form>
    </div>
    <script>
    if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
      function onTurnstileCallback(token) {
        document.getElementById('cf-turnstile-response').value = token;
      }
  
      document.getElementById('exportTokens').addEventListener('submit', function(event) {
        if (!document.getElementById('cf-turnstile-response').value) {
          alert('Please complete the verification.');
          event.preventDefault();
        }
      });
    </script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </body>
  </html>
  `;
}





//admin页面
async function handleAdminPostRequest(request) {
  const formData = await request.formData();
  const adminuserName = formData.get('adminusername');
  const chooseAccount = formData.get('choose_account');
  const forceCar = formData.get('force_car');
  const temporaryAccount = formData.get('temporary_account');
  const turnstileResponse = formData.get('cf-turnstile-response');

  // Verify Turnstile response
  if (!turnstileResponse || !await verifyTurnstile(turnstileResponse)) {
    return generateAdminResponse('Turnstile verification failed');
  }

  // Check if admin username is present
  if (!adminuserName) {
    return generateAdminResponse('Missing adminusername parameter');
  }

  // Get adminusers list
  const adminusers = await KV.get('Admin') || '';
  if (!adminusers || !adminusers.split(',').includes(adminuserName)) {
    return generateAdminResponse('Unauthorized');
  }

  // Handle choose account
  if (chooseAccount) {
    if (chooseAccount.toLowerCase() === 'true') {
      await KV.put('SetAN', 'True');
    } else if (chooseAccount.toLowerCase() === 'no') {
      await KV.put('SetAN', '');
    } else if (!isNaN(chooseAccount)) {
      await KV.put('SetAN', chooseAccount);
    }
  }
  if (forceCar) {
    const forceCarValue = forceCar.toLowerCase() === 'yes' ? '1' : '0';
    await KV.put('ForceAN', forceCarValue);
  }
  if (temporaryAccount) {   
    await KV.put('TemporaryAN', temporaryAccount);
  }
  return generateAdminResponse('Operation completed successfully');
}

async function handleAdminGetRequest() {
  const html = await getAdminHTML();
  return new Response(html, { headers: { 'Content-Type': 'text/html' } });
}

async function generateAdminResponse(message) {
 const errorHtml = `
 <div class="ulp-field ulp-error">
   <div class="ulp-error-info">
     <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
     ${message}
   </div>
 </div>
 `;
 const html = await getAdminHTML();
 const responseHtml = html.replace(
   '<button type="submit">Submit</button>',
   errorHtml + '<button type="submit">Submit</button>'
 );
 return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
}

async function getAdminHTML() {
  const WorkerURL=await KV.get('WorkerURL');
  const turnstileSiteKey=await KV.get('TurnstileSiteKey');
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  return `
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>System Manager</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f2f2f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
    }
    .login-container {
      background-color: #ffffff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .login-container h1 {
      margin-bottom: 24px;
      font-size: 28px;
      color: #333;
      font-weight: 600;
    }
    .login-container label {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
      color: #555;
      text-align: left;
    }
    .login-container input, .login-container select, .login-container button {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      width: 100%;
      margin-bottom: 20px;
    }
    .login-container select {
      height: 48px;
    }
    .login-container button {
      background-color: #007aff;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .login-container button:hover {
      background-color: #005fcb;
    }
    .tokenmanagement-buttons, .usagemanagement-buttons {
      display: flex;
      justify-content: space-between;
    }
    .tokenmanagement-buttons a, .usage-link, .return-button {
      display: block;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      width: 48%;
      background-color: #007aff;
      color: white;
      text-align: center;
      text-decoration: none;
      transition: background-color 0.3s;
      margin-top: 10px;
    }
    .tokenmanagement-buttons a:hover, .usage-link:hover, .return-button:hover {
      background-color: #005fcb;
    }
    .ulp-field.ulp-error .ulp-error-info {
      margin-top: 4px;
      margin-bottom: 4px;
      display: flex;
      font-size: 14px;
      line-height: 1.4;
      text-align: left;
      color: #d00e17;
    }
    .ulp-input-error-icon {
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <h1>System Manager</h1>
    <form id="manageAccountForm" action="/admin" method="POST">
      <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
      <label for="adminusername">Admin Username:</label>
      <input type="password" id="adminusername" name="adminusername" required>
      <label for="choose_account">Choose Account:</label>
      <input type="text" id="choose_account" name="choose_account" placeholder="True, No, or Number">
      <label for="force_car">Force Car:</label>
      <select id="force_car" name="force_car">
        <option value="">Choose...</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
      <label for="temporary_account">Temporary Account:</label>
      <input type="text" id="temporary_account" name="temporary_account">
      <button type="submit">Submit</button>
    </form>
    <div class="tokenmanagement-buttons">
      <a href="https://${WorkerURL}/token">Token Management</a>
      <a href="https://${WorkerURL}/export">Export Tokens</a>
    </div>
    <div class="usagemanagement-buttons">
    <a href="https://${WorkerURL}/user" class="return-button">User Management</a>
      <a href="https://${WorkerURL}/usage" class="usage-link">Query User Usage</a>
    </div>
    <div style="height: 20px;"></div>
    <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
  </div>
  <script>
  if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
  function onTurnstileCallback(token) {
    document.getElementById('cf-turnstile-response').value = token;
  }

  document.getElementById('manageAccountForm').addEventListener('submit', function(event) {
    if (!document.getElementById('cf-turnstile-response').value) {
      alert('Please complete the verification.');
      event.preventDefault();
    }
  });
  </script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</body>
</html>

  `;
}





//user功能

async function handleUserGetRequest() {
  const html = await getUserHTML();
  return new Response(html, { headers: { 'Content-Type': 'text/html' } });
}

async function handleUserPostRequest(request) {
  const formData = await request.formData();
  const adminuserName = formData.get('adminusername');
  const newUsers = formData.get('newusers');
  const userType = formData.get('user_type');
  const turnstileResponse = formData.get('cf-turnstile-response');

  const userRegex = new RegExp(`^${newUsers}_(\\d+)$`);
    let fullUserName = newUsers; 
     const defaultusers = await KV.get("Users")|| '';
     const vipusers = await KV.get("VIPUsers")|| '';
     const freeusers = await KV.get("FreeUsers")|| '';
     const admin = await KV.get("Admin")|| '';
     // 合并所有用户
     const users = `${defaultusers},${vipusers},${freeusers},${admin}`;
    // 自动查找匹配的用户名格式abc_xxx，并添加后缀
    users.split(",").forEach(user => {
      const match = user.match(userRegex);
          if (match) {
              fullUserName = user; // 更新为完整的用户名
          }
      });

  // Verify Turnstile response
  if (!turnstileResponse || !await verifyTurnstile(turnstileResponse)) {
    return generateUserResponse('Turnstile verification failed');
  }

  if (newUsers && userType === 'query-limits') {
    
    const accountNumber = await getToCheckAccountNumber(fullUserName,'Plus');
    const accessToken = await KV.get(`at_${accountNumber}`) || '1';
    const shareToken = await getToCheckShareToken(fullUserName,accessToken);
    const queryLimit = await handleQueryRequest(accessToken,shareToken);
    return generateUserResponse(`User: ${fullUserName}, AN: ${accountNumber}, ${queryLimit}`);
    }

  // Check if parameters are present
  if (!adminuserName || !newUsers || !userType) {
    return generateUserResponse(`Missing parameters: ${!adminuserName ? 'adminusername ' : ''}${!newUsers ? 'newusers ' : ''}${!userType ? 'user_type ' : ''}`);
  }

  // Get adminusers list
  const adminusers = await KV.get('Admin') || '';
  if (!adminusers || !adminusers.split(',').includes(adminuserName)) {
    return generateUserResponse('Unauthorized');
  }

  // Handle user addition or deletion
  if (userType === 'delete') {
   await deleteUsers(fullUserName);
  const users = await KV.get('Users') || '';
  const freeUsers = await KV.get('FreeUsers') || '';
  const vipUsers = await KV.get('VIPUsers') || '';
  return generateUserResponse(`User deleted successfully.\n\nusers:\n${users}\n\nfreeusers:\n${freeUsers}\n\nvipusers:\n${vipUsers}`);
  } 
  else {
    await addUsers(newUsers, userType);
  
  const users = await KV.get('Users') || '';
  const freeUsers = await KV.get('FreeUsers') || '';
  const vipUsers = await KV.get('VIPUsers') || '';
  const WorkerURL=await KV.get('WorkerURL');
  return generateUserResponse(`User Added successfully\n\nLogin link:\nhttps://${WorkerURL}/?un=${newUsers}\n\nusers:\n${users}\n\nfreeusers:\n${freeUsers}\n\nvipusers:\n${vipUsers}`);
  }
}

async function addUsers(newUsers, userType) {
  // Get current user list for the selected user type
  const currentUsers = await KV.get(userType) || '';

  // Append new users
  const updatedUsers = `${currentUsers},${newUsers}`.replace(/^,/, '');
  // Update KV store
  await KV.put(userType, updatedUsers);
}

async function deleteUsers(usersToDelete) {
  const userTypes = ['Users', 'FreeUsers', 'VIPUsers'];

  //删除用户
  for (const userType of userTypes) {
    const currentUsers = await KV.get(userType) || '';
    const updatedUsers = currentUsers.split(',').filter(user => !usersToDelete.split(',').includes(user)).join(',');

    // Update KV store
    await KV.put(userType, updatedUsers);
  }
  //删除用户的历史sharetoken
  return await deleteShareToken(usersToDelete);
}
    
async function deleteShareToken(userName) {
  const url = 'https://chat.oaifree.com/token/register';
  const passed = generatePassword(userName)
  
  const accountNumber = await getToCheckAccountNumber(userName,'Plus');
  const accessToken = await KV.get(`at_${accountNumber}`) || '1';
 /*  
   const tokenPrefix = await KV.get('TokenPrefix');
  const baseUserName = tokenPrefix + userName.replace(/_\d+$/, ''); // 移除用户名后的编号 */

  //console.log(`getShareToken - userName: ${userName}, accountNumber: ${accountNumber}, showConversations: ${isAdmin}, isTemporary: ${isTemporary}`);
  const body = new URLSearchParams({
      access_token: accessToken,  // 使用从全局变量中获取的 accessToken
      unique_name: passed, //前缀+无后缀用户名
     // site_limit: '', // 限制的网站
      expires_in: '-1', // token有效期（单位为秒），填 0 则永久有效
     // gpt35_limit: '0', // gpt3.5 对话限制
     // gpt4_limit: '0', // gpt4 对话限制，-1为不限制
     // show_conversations: 'false', // 是否显示所有人的会话
     // temporary_chat: 'false', //默认启用临时聊天
     // show_userinfo: 'false', // 是否显示用户信息
     // reset_limit: 'false' // 是否重置对话限制
  }).toString();
  await fetch(url, {
      method: 'POST',
      headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: body
  });
  return 'Delete ST suceed.';
}

async function getToCheckShareToken(userName,accessToken) {
  const url = 'https://chat.oaifree.com/token/register';
  const passed = generatePassword(userName)
 /*  
   const tokenPrefix = await KV.get('TokenPrefix');
  const baseUserName = tokenPrefix + userName.replace(/_\d+$/, ''); // 移除用户名后的编号 */
  //console.log(`getShareToken - userName: ${userName}, accountNumber: ${accountNumber}, showConversations: ${isAdmin}, isTemporary: ${isTemporary}`);
  const body = new URLSearchParams({
      access_token: accessToken,  // 使用从全局变量中获取的 accessToken
      unique_name: passed, //前缀+无后缀用户名
      //site_limit: '', // 限制的网站
      //expires_in: '0', // token有效期（单位为秒），填 0 则永久有效
      //gpt35_limit: '-1', // gpt3.5 对话限制
      //gpt4_limit: '-1', // gpt4 对话限制，-1为不限制
      //show_conversations: 'false', // 是否显示所有人的会话
      //temporary_chat: 'false', //默认启用临时聊天
      //show_userinfo: 'false', // 是否显示用户信息
      reset_limit: 'false' // 是否重置对话限制
    }).toString();
    const apiResponse = await fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: body
    });
    const responseText = await apiResponse.text();
    const tokenKeyMatch = /"token_key":"([^"]+)"/.exec(responseText);
    const tokenKey = tokenKeyMatch ? tokenKeyMatch[1] : 'Can not get share token.';
    return tokenKey;
}

async function generateUserResponse(message) {

 const errorHtml = `
 <div class="ulp-field ulp-error">
   <div class="ulp-error-info">
     <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
     ${message}
   </div>
 </div>
 `;
 const html = await getUserHTML();
 const responseHtml = html.replace(
   '<button type="submit">Submit</button>',
   errorHtml + '<button type="submit">Submit</button>'
 );
 return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
}

async function getToCheckAccountNumber(userName, antype) {
  // Retrieve the last login logs
  const lastLoginLogs = await KV.get(`${antype}LoginLogs`);
  if (lastLoginLogs) {
    const logArray = JSON.parse(lastLoginLogs);
    const userLogs = logArray.filter(log => log.user === userName);
    if (userLogs.length > 0) {
      const lastAccount = userLogs[userLogs.length - 1].accountNumber;
      return lastAccount;
    }
  }
  return 1;  // 返回 1 表示没有找到符合条件的账户
}
async function handleQueryRequest(accessToken, shareToken) {
  const limits = await queryLimits(accessToken, shareToken);

  return `Usage: GPT-4: ${limits.gpt4Limit}, GPT-3.5: ${limits.gpt35Limit}`;
}



async function queryLimits(accessToken, shareToken) {
  const CACHE_TTL = 60; // 缓存时间，单位为秒
  const MAX_RETRIES = 3; // 最大重试次数
  const cacheKey = `limits_${shareToken}`;
  const cachedData = await KV.get(cacheKey);
  if (cachedData) {
    return JSON.parse(cachedData);
  }

  const url = `https://chat.oaifree.com/token/info/${shareToken}`;
  let attempt = 0;

  while (attempt < MAX_RETRIES) {
    try {
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        throw new Error(`Failed to fetch limits (status: ${response.status})`);
      }

      const result = await response.json();
      const data = {
        gpt4Limit: result.gpt4_limit,
        gpt35Limit: result.gpt35_limit
      };

      await KV.put(cacheKey, JSON.stringify(data), { expirationTtl: CACHE_TTL }); // 缓存数据
      return data;

    } catch (error) {
      console.error(`Attempt ${attempt + 1} failed:`, error);
      attempt += 1;

      if (attempt >= MAX_RETRIES) {
        throw new Error('Failed to fetch limits after multiple attempts');
      }

      // 可选：在重试前等待一段时间
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
}


async function getUserHTML() {
  const turnstileSiteKey=await KV.get('TurnstileSiteKey');
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Account</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f2f2f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
    }
    .login-container {
      background-color: #ffffff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .login-container h1 {
      margin-bottom: 24px;
      font-size: 28px;
      color: #333;
      font-weight: 600;
    }
    .login-container label {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
      color: #555;
      text-align: left;
    }
    .login-container input, .login-container select, .login-container button {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      width: 100%;
      margin-bottom: 20px;
    }
    .login-container select {
      height: 48px;
    }
    .login-container button {
      background-color: #007aff;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .login-container button:hover {
      background-color: #005fcb;
    }
    .ulp-field.ulp-error .ulp-error-info {
      margin-top: 4px;
      margin-bottom: 4px;
      display: flex;
      font-size: 14px;
      line-height: 1.4;
      text-align: left;
      color: #d00e17;
  }
  .ulp-input-error-icon {
      margin-right: 4px;
  }
  </style>
</head>
<body>
  <div class="login-container">
    <h1>Manage Account</h1>
    <form id="manageAccountForm" action="/user" method="POST">
    <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
      <label for="adminusername">Admin Username:</label>
      <input type="password" id="adminusername" name="adminusername">
      <label for="newusers">User Name:</label>
      <input type="text" id="newusers" name="newusers" required>
      <label for="user_type">Operation Type:</label>
      <select id="user_type" name="user_type" required>
        <option value="query-limits">Query Usage</option>
        <option value="Users">Add Users</option>
        <option value="FreeUsers">Add Free Users</option>
        <option value="VIPUsers">Add VIP Users</option>
        <option value="delete">Delete Users</option>
       
      </select>
      <button type="submit">Submit</button>
      <div style="height: 20px;"></div>
      <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
    </form>
  </div>
  <script>
if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
  function onTurnstileCallback(token) {
    document.getElementById('cf-turnstile-response').value = token;
  }

  document.getElementById('manageAccountForm').addEventListener('submit', function(event) {
    if (!document.getElementById('cf-turnstile-response').value) {
      alert('Please complete the verification.');
      event.preventDefault();
    }
  });
  </script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</body>
</html>
`;
}




//Register功能
async function handleRegisterPostRequest(request) {
  const formData = await request.formData()
  const cdkey = formData.get('cdkey')
  const username = formData.get('username')
  const turnstileResponse = formData.get('cf-turnstile-response')

  if (!await verifyTurnstile(turnstileResponse)) {
    return generateRegisterResponse('Turnstile verification failed')
  }

  const autoDeleteCDK = await KV.get('AutoDeleteCDK')
  const cdkeyStore = await KV.get('CDKEY') || '';
  const cdkeyList = cdkeyStore ? cdkeyStore.split(',') : []

  if (!cdkeyList.includes(cdkey)) {
    return generateRegisterResponse('Invalid CDKEY')
  }
  await registerlog(username, cdkey);
  if (autoDeleteCDK){
  // Remove used CDKEY and update store
  const updatedCdkeyList = cdkeyList.filter(key => key !== cdkey)
  await KV.put('CDKEY', updatedCdkeyList.join(','))
  }

  // Add new user to freeusers
  const freeUsers = await KV.get('FreeUsers')
  const freeUsersList = freeUsers ? freeUsers.split(',') : []
  if (freeUsersList.includes(username)) {
    return generateRegisterResponse('Username already exist.')
  }
    freeUsersList.push(username)
    await KV.put('FreeUsers', freeUsersList.join(','))
  

  return generateRegisterResponse('Registration successful')
}

async function registerlog(userName, cdkey) {
  const currentTime = new Date().toLocaleString("zh-CN", { timeZone: "Asia/Shanghai" });
  const logEntry = {
      user: userName,
      time: currentTime,
      cdkey: cdkey
  };
  // Retrieve the existing log array or create a new one if it doesn't exist
  const lastDeleteLogs = await KV.get(`RegisterLogs`);
  let logArray = [];
  if (lastDeleteLogs) {
      logArray = JSON.parse(lastDeleteLogs);
  }
  logArray.push(logEntry);
  await KV.put(`RegisterLogs`, JSON.stringify(logArray));
 }

async function generateRegisterResponse(message) {
   const errorHtml = `
   <div class="ulp-field ulp-error">
     <div class="ulp-error-info">
       <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
       ${message}
     </div>
   </div>
   `;
   const html = await getRegisterHTML();
   const responseHtml = html.replace(
     '<button class="continue-btn" type="button" id="continueBtn">Continue</button>',
     errorHtml + '<button class="continue-btn" type="button" id="continueBtn">Continue</button>'
   );
   return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
 }

 
async function getRegisterHTML() {
  const WorkerURL=await KV.get('WorkerURL');
  const turnstileSiteKey=await KV.get('TurnstileSiteKey');
  const websiteName = await KV.get('WebName') || 'Haibara AI';
  const logourl = await KV.get('LogoURL') || logo;
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  return `
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <link rel="apple-touch-icon" sizes="180x180" href="https://cdn1.oaifree.com/_next/static/media/apple-touch-icon.82af6fe1.png"/>
      <link rel="icon" type="image/png" sizes="32x32" href="https://cdn4.oaifree.com/_next/static/media/favicon-32x32.630a2b99.png"/>
      <link rel="icon" type="image/png" sizes="16x16" href="https://cdn4.oaifree.com/_next/static/media/favicon-16x16.a052137e.png"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Sign Up - ${websiteName}</title>
      <style>
          @charset "UTF-8";
          .oai-header img {
              height: auto;
              width: 128px;
              margin-top: 80px;
          }
  
          a {
              font-weight: 400;
              text-decoration: inherit;
              color: #10a37f;
          }
  
          .main-container {
              flex: 1 0 auto;
              min-height: 0;
              display: grid;
              box-sizing: border-box;
              grid-template-rows: [left-start center-start right-start] 1fr [left-end center-end right-end];
              grid-template-columns: [left-start center-start] 1fr [left-end right-start] 1fr [center-end right-end];
              align-items: center;
              justify-content: center;
              justify-items: center;
              grid-column-gap: 160px;
              column-gap: 160px;
              padding: 80px;
              width: 100%;
          }
  
          .login-container {
              background-color: #fff;
              padding: 0 40px 40px;
              border-radius: 3px;
              box-shadow: none;
              width: 320px;
              box-sizing: content-box;
              flex-shrink: 0;
          }
  
          .title-wrapper {
              padding: 0 40px 24px;
              box-sizing: content-box;
              text-align: center;
          }
  
          .title {
              font-size: 32px;
              font: 'Söhne';
              margin: 0;
              color: #2d333a;
              width: 320px;
          }
  
          .input-wrapper {
              position: relative;
              margin-bottom: 25px;
              width: 320px;
              box-sizing: content-box;
          }
  
          .email-input {
              -webkit-appearance: none;
              -moz-appearance: none;
              appearance: none;
              background-color: #fff;
              border: 1px solid #c2c8d0;
              border-radius: 6px;
              box-sizing: border-box;
              color: #2d333a;
              font-family: inherit;
              font-size: 16px;
              height: 52px;
              line-height: 1.1;
              outline: none;
              padding-block: 1px;
              padding-inline: 2px;
              padding: 0 16px;
              transition:
                  box-shadow 0.2s ease-in-out,
                  border-color 0.2s ease-in-out;
              width: 100%;
              text-rendering: auto;
              letter-spacing: normal;
              word-spacing: normal;
              text-transform: none;
              text-indent: 0px;
              text-shadow: none;
              display: inline-block;
              text-align: start;
              margin: 0;
          }
  
          .email-input:focus,
          .email-input:valid {
              border: 1px solid #10a37f;
              outline: none;
          }
  
          .email-input:focus-within {
              box-shadow: 1px #10a37f;
          }
  
          .email-input:focus + .email-label,
          .email-input:valid + .email-label {
              font-size: 14px;
              top: 0;
              left: 10px;
              color: #10a37f;
              background-color: #fff;
          }
  
          .email-label {
              position: absolute;
              top: 26px;
              left: 16px;
              background-color: #fff;
              color: #6f7780;
              font-size: 16px;
              font-weight: 400;
              margin-bottom: 8px;
              max-width: 90%;
              overflow: hidden;
              pointer-events: none;
              padding: 1px 6px;
              text-overflow: ellipsis;
              transform: translateY(-50%);
              transform-origin: 0;
              transition:
                  transform 0.15s ease-in-out,
                  top 0.15s ease-in-out,
                  padding 0.15s ease-in-out;
              white-space: nowrap;
              z-index: 1;
          }
  
          .continue-btn {
              position: relative;
              height: 52px;
              width: 320px;
              background-color: #10a37f;
              color: #fff;
              margin: 24px 0 0;
              align-items: center;
              justify-content: center;
              display: flex;
              border-radius: 6px;
              padding: 4px 16px;
              font: inherit;
              border-width: 0px;
              cursor: pointer;
          }
  
          .continue-btn:hover {
              box-shadow: inset 0 0 0 150px #0000001a;
          }
  
          :root {
              font-family:
                  Söhne,
                  -apple-system,
                  BlinkMacSystemFont,
                  Helvetica,
                  sans-serif;
              line-height: 1.5;
              font-weight: 400;
              font-synthesis: none;
              text-rendering: optimizeLegibility;
              -webkit-font-smoothing: antialiased;
              -moz-osx-font-smoothing: grayscale;
          }
  
          .page-wrapper {
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              min-height: 100%;
          }
  
          .oai-header {
              display: flex;
              justify-content: center;
              align-items: center;
              width: 100%;
              background-color: #fff;
          }
  
          body {
              background-color: #fff;
              display: block;
              margin: 0;
          }
  
          .content-wrapper {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: auto;
              white-space: normal;
              border-radius: 5px;
              position: relative;
              grid-area: center;
              box-shadow: none;
              vertical-align: baseline;
              box-sizing: content-box;
          }
  
          .checkbox-wrapper {
              margin: 20px 0;
              display: flex;
              align-items: center;
          }
  
          .checkbox-label {
              margin-left: 8px;
              font-weight: 600;
              color: #6f7780;
              font-size: 14px;
          }
  
          .help-icon {
              display: inline-block;
              margin-left: 5px;
              color: #10a37f;
              cursor: pointer;
              font-weight: bold;
          }
  
          .tooltip {
              visibility: hidden;
              min-width: 140px;
              max-width: 300px;
              line-height: 20px; 
              min-height: 90px; 
              display: flex;
              align-items: center;
              justify-content: center;
              background-color: black;
              color: #fff;
              text-align: center;
              border-radius: 6px;
              
              position: absolute;
              z-index: 1;
              bottom: 150%;
              left: 50%;
              margin-left: -70px; /* Half of the width to center the tooltip */
              opacity: 0;
              transition: opacity 0.3s, visibility 0.3s ease-in-out;
          }
  
          .tooltip::after {
              content: "";
              position: absolute;
              top: 100%;
              left: 50%;
              margin-left: -5px;
              border-width: 5px;
              border-style: solid;
              border-color: black transparent transparent transparent;
          }
  
          .field-container {
              display: flex;
              margin-bottom: 20px;
              width: 320px;
              box-sizing: content-box;
          }
  
          .field-container select {
              flex: 3;
              padding: 12px;
              border: 1px solid #c2c8d0;
              border-radius: 6px 0 0 6px;
              font-size: 16px;
          }
  
          .field-container input[type="number"] {
              flex: 1;
              padding: 12px;
              border: 1px solid #c2c8d0;
              border-radius: 0 6px 6px 0;
              font-size: 16px;
          }
  
          .cf-turnstile {
              display: flex;
              justify-content: center;
              margin-top: 10px;
          }
          .other-page {
              text-align: center;
              margin-top: 14px;
              margin-bottom: 0;
              font-size: 14px;
              width: 320px;
          }
          .divider-wrapper {
              display: flex;
              flex-direction: row;
              text-transform: uppercase;
              border: none;
              font-size: 12px;
              font-weight: 400;
              margin: 0;
              padding: 24px 0 0;
              align-items: center;
              justify-content: center;
              width: 320px;
              vertical-align: baseline;
          }
          
          .divider-wrapper:before {
              content: "";
              border-bottom: 1px solid #c2c8d0;
              flex: 1 0 auto;
              height: .5em;
              margin:0
          }
          .divider-wrapper:after{
              content: "";
              border-bottom: 1px solid #c2c8d0;
              flex: 1 0 auto;
              height: .5em;
              margin:0
          }
          .ulp-field.ulp-error .ulp-error-info {
            margin-top: 4px;
            margin-bottom: 4px;
            display: flex;
            font-size: 14px;
            line-height: 1.4;
            text-align: left;
            color: #d00e17;
        }
        
        .ulp-input-error-icon {
            margin-right: 4px;
        }

        .footer {
          text-align: center;
          font-size: 12px;
          padding: 10px;
      }

      .footer a {
          color: black;
          text-decoration: none;
      }

      .footer a:hover {
          text-decoration: none;
          color: black;
      }

          </style>
          </head>
          <body>
              <div id="root">
                  <div class="page-wrapper">
                      <header class="oai-header">
                          <a href="https://${WorkerURL}/admin">
                              <img src="${logourl}" alt="Logo">
                          </a>
                      </header>
                      <main class="main-container">
                          <section class="content-wrapper">
                              <div class="title-wrapper"><h1 class="title">Create your account</h1></div>
                              <div class="login-container">
                                  <form id="manageAccountForm0" action="/register" method="POST">
                                      <div class="input-wrapper" id="cdkeyWrapper">
                                          <input
                                              class="email-input"
                                              inputmode="text"
                                              type="text"
                                              id="cdkey"
                                              name="cdkey"
                                              autocomplete="off"
                                              autocapitalize="none"
                                              spellcheck="false"
                                              required
                                              placeholder=" "
                                          />
                                          <label class="email-label" for="cdkey">CDKEY</label>
                                      </div>
                                      <div class="input-wrapper" id="usernameWrapper" style="display: none;">
                                      <input
                                          class="email-input"
                                          inputmode="text"
                                          type="text"
                                          id="username"
                                          name="username"
                                          autocomplete="off"
                                          autocapitalize="none"
                                          spellcheck="false"
                                          placeholder=" "
                                          required
                                      />
                                      <label class="email-label" for="username">Your Username</label>
                                    </div>
                                      <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
                                      <button class="continue-btn" type="button" id="continueBtn">Continue</button>
                                      <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
                                  </form>
          
                                  <div class="divider-wrapper"><span class="divider">Or</span></div>
                                  <p class="other-page">Already have an account? <a class="other-page-link" href="https://${WorkerURL}">Login</a></p>
                              </div>
                          </section>
                      </main>
                  </div>
              </div>
              <footer class="footer">
                <p>&copy; All rights reserved. | Powered by <a href="https://linux.do" target="_blank">Pandora</a> & <a href="https://chatgpt.com" target="_blank">ChatGPT</a></p>
            </footer>
              <script>
              if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
                  document.addEventListener('DOMContentLoaded', function() {
                      const cdkeyInput = document.getElementById('cdkey');
                      const usernameWrapper = document.getElementById('usernameWrapper');
                      const continueBtn = document.getElementById('continueBtn');
                      const manageAccountForm = document.getElementById('manageAccountForm0');
          
                      continueBtn.addEventListener('click', function() {
                          if (cdkeyInput.value.trim() && usernameWrapper.style.display === 'none') {
                              usernameWrapper.style.display = 'block';
                          } else if (cdkeyInput.value.trim() && usernameWrapper.style.display === 'block') {
                              const usernameInput = document.getElementById('username');
                              if (usernameInput.value.trim() && document.getElementById('cf-turnstile-response').value) {
                                  manageAccountForm.submit();
                              } else if (!document.getElementById('cf-turnstile-response').value) {
                                  alert('Please complete the verification.');
                              } else {
                                  alert('Please enter your username.');
                              }
                          }
                      });
          
                      manageAccountForm.addEventListener('submit', function(event) {
                          if (!document.getElementById('cf-turnstile-response').value) {
                              alert('Please complete the verification.');
                              event.preventDefault();
                          }
                      });
                  });
          
                  function onTurnstileCallback(token) {
                      document.getElementById('cf-turnstile-response').value = token;
                  }
              </script>
              <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
          </body>
          </html>
  `;
}






//Usage查询功能
const MAX_USERS_PER_BATCH = 5;
async function handleUsageRequest(request) {
  if (request.method === 'POST') {
    const url = new URL(request.url);
    if (url.pathname === '/usage/save') {
      const usersData = await request.json();
      await saveUsageLogs(usersData);
      return new Response('Data saved successfully.', { status: 200 });
    } else {
      const formData = await request.formData();
      const adminUsername = formData.get('adminusername');
      const queryType = formData.get('queryType');
      const turnstileResponse = formData.get('cf-turnstile-response')
      const adminUsers = await KV.get('Admin');
      if (!await verifyTurnstile(turnstileResponse)) {
        return generateUsageResponse('Turnstile verification failed')
      }
      if (adminUsers.split(',').includes(adminUsername)) {
        const logs = queryType === 'plus' ? ['PlusLoginLogs'] : ['FreeLoginLogs'];
        let usersData = [];
        let uniqueUsers = new Set();

        for (const log of logs) {
          const loginLogs = await KV.get(log);
          if (loginLogs) {
            const logArray = JSON.parse(loginLogs);
            const chinaTimeZone = 'Asia/Shanghai';
            const today = new Date().toLocaleDateString('en-US', { timeZone: chinaTimeZone });
            const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toLocaleDateString('en-US', { timeZone: chinaTimeZone });

            const recentLogs = logArray.filter(log => {
              const logDate = new Date(log.timestamp).toLocaleDateString('en-US', { timeZone: chinaTimeZone });
              return logDate === today || logDate === yesterday;
            });

            recentLogs.forEach(logEntry => uniqueUsers.add(logEntry.user));
          }
        }

        const usersArray = Array.from(uniqueUsers);
        for (let i = 0; i < usersArray.length; i += MAX_USERS_PER_BATCH) {
          const batchUsers = usersArray.slice(i, i + MAX_USERS_PER_BATCH);
          const batchUsersData = await processBatchUsers(batchUsers, queryType);
          usersData = usersData.concat(batchUsersData);
        }

        const htmlResponse = await generateTableHTML(usersData, queryType);
        return new Response(htmlResponse, { headers: { 'Content-Type': 'text/html' } });
      } else {
        const accountNumber = await getTableToCheckAccountNumber(adminUsername, queryType);
        const accessToken = await KV.get(`at_${accountNumber}`) || '1';
        const shareToken = await getToCheckShareToken(adminUsername,accessToken);
        const queryLimit = await handleQueryRequest(accessToken,shareToken);
        return generateUsageResponse(`User: ${adminUsername}, AN: ${accountNumber}, ${queryLimit}`);
      }
    }
  } else {
    return new Response(await getTableUserHTML(), { headers: { 'Content-Type': 'text/html' } });
  }
}

async function processBatchUsers(users, queryType) {
  const usersData = await Promise.all(users.map(user => processSingleUser(user, queryType).catch(error => {
    console.error(`Error processing user ${user}:`, error);
    return {
      user,
      accountNumber: 'Unknown',
      queryType,
      gpt4: 'Error',
      gpt35: 'Error'
    };
  })));
  return usersData;
}

async function processSingleUser(user, queryType) {
  const accountNumber = await getTableToCheckAccountNumber(user, queryType);
  const accessToken = await KV.get(`at_${accountNumber}`) || '1';
  const shareToken = await getToCheckShareToken(user, accessToken);
  const usage = await queryLimits(accessToken, shareToken);

  return {
    user,
    accountNumber,
    queryType,
    ...parseUsage(usage)
  };
}



function parseUsage(usage) {
  return {
    gpt4: usage.gpt4Limit !== undefined ? usage.gpt4Limit : 'N/A',
    gpt35: usage.gpt35Limit !== undefined ? usage.gpt35Limit : 'N/A'
  };
}

async function getTableToCheckAccountNumber(userName, queryType) {
  const logs = queryType === 'plus' ? ['PlusLoginLogs'] : ['FreeLoginLogs'];
    const lastLoginLogs = await KV.get(logs);
    if (lastLoginLogs) {
      const logArray = JSON.parse(lastLoginLogs);
      const userLogs = logArray.filter(log => log.user === userName);
      if (userLogs.length > 0) {
        const lastAccount = userLogs[userLogs.length - 1].accountNumber;
        return lastAccount;
      }
    }
  return 'Unknown';
}

async function saveUsageLogs(usersData) {
  const queryType = usersData[0].queryType;
  const logType = queryType === 'plus' ? 'PlusUsageLogs' : 'FreeUsageLogs';
  const currentLogs = await KV.get(logType);
  const logs = currentLogs ? JSON.parse(currentLogs) : [];
  const chinaTime = new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' });
  logs.push({ timestamp: chinaTime, usersData });
  await KV.put(logType, JSON.stringify(logs));
}


async function getTableUserHTML() {
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
  const turnstileSiteKey = await KV.get('TurnstileSiteKey');
  return `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Query User Usage</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f2f2f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
      }
      .login-container {
        background-color: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        text-align: center;
      }
      .login-container h1 {
        margin-bottom: 24px;
        font-size: 28px;
        color: #333;
        font-weight: 600;
      }
      .login-container label {
        display: block;
        font-size: 16px;
        margin-bottom: 8px;
        color: #555;
        text-align: left;
      }
      .login-container input, .login-container select, .login-container button {
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        width: 100%;
        margin-bottom: 20px;
      }
      .login-container select {
        height: 48px;
      }
      .login-container .button-group {
        display: flex;
        justify-content: space-between;
      }
      .login-container .button-group button {
        width: 48%;
      }
      .login-container button {
        background-color: #007aff;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .login-container button:hover {
        background-color: #005fcb;
      }
      .ulp-field.ulp-error .ulp-error-info {
        margin-top: 4px;
        margin-bottom: 4px;
        display: flex;
        font-size: 14px;
        line-height: 1.4;
        text-align: left;
        color: #d00e17;
    }
    .ulp-input-error-icon {
        margin-right: 4px;
    }
    </style>
  </head>
  <body>
    <div class="login-container">
      <h1>Query User Usage</h1>
      <form id="queryUsageForm" action="/usage" method="POST">
        <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
        <label for="adminusername">Admin Username:</label>
        <input type="password" id="adminusername" name="adminusername">
        <div class="button-group">
          <button type="submit" name="queryType" value="plus">Plus Usage</button>
          <button type="submit" name="queryType" value="free">Free Usage</button>
        </div>
        <div style="height: 20px;"></div>
        <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
      </form>
    </div>
    <script>
    if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
    function onTurnstileCallback(token) {
      document.getElementById('cf-turnstile-response').value = token;
    }
  
    document.getElementById('queryUsageForm').addEventListener('submit', function(event) {
      if (!document.getElementById('cf-turnstile-response').value) {
        alert('Please complete the verification.');
        event.preventDefault();
      }
    });
    </script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </body>
  </html>
  `;
}
async function generateUsageResponse(message) {
  const errorHtml = `
    <div class="ulp-field ulp-error">
      <div class="ulp-error-info">
        <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
        ${message}
      </div>
    </div>
  `;

  const html = await getTableUserHTML();
  const responseHtml = html.replace(
    '<div class="button-group">',
    errorHtml + '<div class="button-group">'
  );
  return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
}

async function generateTableHTML(usersData, queryType) {
  const logourl = await KV.get('LogoURL') || logo;
  const pageTitle = "Usage Chart";
  const historyData = await getHistoryData(queryType);

  let combinedData = combineData(usersData, historyData);
  let headerRow = generateHeaderRow(historyData);
  let timestampRow = generateTimestampRow(historyData);
  let rows = combinedData.map(user => `
  <tr class="user-row">
    <td class="user-sticky user-name">${user.user}</td>
    ${user.historyUsage.map(usage => `<td>${usage.gpt4}</td><td>${usage.gpt35}</td>`).join('')}
    <td>${user.realTimeUsage.gpt4}</td>
    <td>${user.realTimeUsage.gpt35}</td>
  </tr>`).join('');

  return `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>User Usage</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f2f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .header {
        display: flex;
        align-items: center;
        margin: 20px;
        width: 80%;
      }
      .logo {
        height: 50px;
        margin-right: 20px;
      }
      .title {
        font-size: 24px;
        font-weight: bold;
      }
      .table-container {
        width: 80%;
        overflow-x: auto;
        margin: 20px 0;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 18px;
        text-align: left;
        position: relative;
        min-width: 800px;
      }
      th, td {
        padding: 12px;
        border: 1px solid #ddd;
      }
      th {
        background-color: #007aff;
        color: white;
      }
      .button-group {
        position: absolute;
        top: 20px;
        right: 20px;
      }
      .button {
        margin-left: 10px;
        padding: 5px 10px;
        background-color: #007aff;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
      }
      .user-name.masked {
        filter: blur(5px);
      }
      th.user-sticky, td.user-sticky {
        position: sticky;
        left: 0;
        color: white;
        background-color: #007aff;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <img src="${logourl}" alt="Logo" class="logo">
      <div class="title">${pageTitle}</div>
    </div>
    <div class="button-group">
      <button class="button" onclick="toggleMask()">Mask/Unmask</button>
      <button class="button" onclick="saveData()">Save</button>
    </div>
    <div class="table-container">
      <table>
      <tr>
      <th class="user-sticky">User</th>
      ${timestampRow}
      <th colspan="2">Real-Time Usage</th>
    </tr>
    <tr>
      <th class="user-sticky"></th>
      ${headerRow}
      <th>GPT-4</th>
      <th>GPT-3.5</th>
    </tr>
        ${rows}
      </table>
    </div>
    <script>
      let isMasked = false;
  
      function toggleMask() {
        isMasked = !isMasked;
        const userNames = document.querySelectorAll('.user-name');
        userNames.forEach(userName => {
          if (isMasked) {
            userName.classList.add('masked');
          } else {
            userName.classList.remove('masked');
          }
        });
      }
  
      function saveData() {
        fetch('/usage/save', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(${JSON.stringify(usersData)})
        })
        .then(response => response.text())
        .then(result => alert(result))
        .catch(error => console.error('Error:', error));
      }
  
      document.querySelectorAll('.user-row').forEach(row => {
        row.addEventListener('mouseover', function() {
          if (isMasked) {
            this.querySelector('.user-name').classList.remove('masked');
          }
        });
        row.addEventListener('mouseout', function() {
          if (isMasked) {
            this.querySelector('.user-name').classList.add('masked');
          }
        });
      });
    </script>
  </body>
  </html>
  
  `;
}

function combineData(usersData, historyData) {
  let combinedData = [];
  let allUsers = new Set(usersData.map(u => u.user).concat(historyData.flatMap(h => h.usersData.map(u => u.user))));

  allUsers.forEach(user => {
    let historyUsage = historyData.map(h => {
      let userUsage = h.usersData.find(u => u.user === user);
      return userUsage ? { gpt4: userUsage.gpt4, gpt35: userUsage.gpt35 } : { gpt4: '', gpt35: '' };
    });
    let realTimeUsage = usersData.find(u => u.user === user);
    combinedData.push({
      user,
      historyUsage,
      realTimeUsage: realTimeUsage ? { gpt4: realTimeUsage.gpt4, gpt35: realTimeUsage.gpt35 } : { gpt4: '', gpt35: '' }
    });
  });

  return combinedData;
}

function generateHeaderRow(historyData) {
  return historyData.map(h => `<th>GPT-4</th><th>GPT-3.5</th>`).join('');
}

function generateTimestampRow(historyData) {
  return historyData.map(h => `<th colspan="2">${h.timestamp}</th>`).join('');
}

async function getHistoryData(queryType) {
  const logType = queryType === 'plus' ? 'PlusUsageLogs' : 'FreeUsageLogs';
  const historyLogs = await KV.get(logType);
  return historyLogs ? JSON.parse(historyLogs) : [];
}


function combineData(usersData, historyData) {
  let combinedData = [];
  let allUsers = new Set(usersData.map(u => u.user).concat(historyData.flatMap(h => h.usersData.map(u => u.user))));

  allUsers.forEach(user => {
    let historyUsage = historyData.map(h => {
      let userUsage = h.usersData.find(u => u.user === user);
      return userUsage ? { gpt4: userUsage.gpt4, gpt35: userUsage.gpt35 } : { gpt4: '', gpt35: '' };
    });
    let realTimeUsage = usersData.find(u => u.user === user);
    combinedData.push({
      user,
      historyUsage,
      realTimeUsage: realTimeUsage ? { gpt4: realTimeUsage.gpt4, gpt35: realTimeUsage.gpt35 } : { gpt4: '', gpt35: '' }
    });
  });

  return combinedData;
}

function generateHeaderRow(historyData) {
  return historyData.map(h => `<th>GPT-4</th><th>GPT-3.5</th>`).join('');
}

function generateTimestampRow(historyData) {
  return historyData.map(h => `<th colspan="2">${h.timestamp}</th>`).join('');
}

async function getHistoryData(queryType) {
  const logType = queryType === 'plus' ? 'PlusUsageLogs' : 'FreeUsageLogs';
  const historyLogs = await KV.get(logType);
  return historyLogs ? JSON.parse(historyLogs) : [];
}












//login功能
async function handleLoginGetRequest(request) {
  const url = new URL(request.url);

    
  const params = new URLSearchParams(url.search);
  const userName = params.get('un');
  const setan = await KV.get('SetAN');
  const accountNumber = params.get('an-custom') || params.get('an') || '1';

  if (userName) {
      return await handleLogin(userName, accountNumber, 'do not need Turnstle','');
  } else {
    const html = await getLoginHTML(setan);
    return new Response(html, { headers: { 'Content-Type': 'text/html' } });
  }
}


  async function handleLoginPostRequest(request) {
    const formData = await request.formData();
    const userName = formData.get('un');
    const anissues = formData.get('anissues') === 'on';
    const accountNumber =formData.get('an-custom') || formData.get('an') || '1';

    const turnstileResponse = formData.get('cf-turnstile-response');
    return await handleLogin(userName, accountNumber, turnstileResponse,anissues);
  }
function isTokenExpired(token) {
  // 检查 token 是否存在，如果不存在或为空字符串，直接返回 true
  if (!token || token === "Bad_RT" ||token === "Bad_AT" ) {
      return true;
  }
  const payload = parseJwt(token);
  const currentTime = Math.floor(Date.now() / 1000);// 获取当前时间戳（秒）
  return payload.exp < currentTime;// 检查 token 是否过期
}
async function getOAuthLink(shareToken, proxiedDomain) {
  // const url = `https://${proxiedDomain}/api/auth/oauth_token`;
   // 不知道为什么，好像没法直接通过反代的服务器获取oauth link
 const url = `https://new.oaifree.com/api/auth/oauth_token`;
 const response = await fetch(url, {
     method: 'POST',
     headers: {
         'Origin': `https://${proxiedDomain}`,
         'Content-Type': 'application/json',
     },
     body: JSON.stringify({
         share_token: shareToken
     })
 })
 const data = await response.json();
 return data.login_url;
}
async function getShareToken(userName, accessToken,accountNumber) {
 const url = 'https://chat.oaifree.com/token/register'; 
 // const tokenPrefix = await KV.get('TokenPrefix');
 //const baseUserName = tokenPrefix + userName.replace(/_\d+$/, ''); // 移除用户名后的编号

 const isAdmin = await usermatch(userName, 'Admin') || userName=='atdirect';
 const isVIP = await usermatch(userName, 'VIPUsers') || await usermatch(userName, 'Admin') ;
 const isFreeUsers = await usermatch(userName, 'FreeUsers');
 const isTemporary = await usermatch(accountNumber, 'TemporaryAN') && !isAdmin;

 const passwd = await generatePassword(userName);
 
 //console.log(`getShareToken - userName: ${userName}, accountNumber: ${accountNumber}, showConversations: ${isAdmin}, isVIP: ${isVIP}, isTemporary: ${isTemporary}, accessToken: ${accessToken}, passwd: ${passwd}`);
 const body = new URLSearchParams({
     access_token: accessToken,  // 使用从全局变量中获取的 accessToken
     unique_name: passwd, //前缀+无后缀用户名
     site_limit: '', // 限制的网站
     expires_in: isVIP ? '0' : '86400', // token有效期（单位为秒），填 0 则永久有效
     gpt35_limit: '-1', // gpt3.5 对话限制
     gpt4_limit: isFreeUsers ? '30' : '-1', // gpt4 对话限制，-1为不限制
     show_conversations: isAdmin ? 'true' : 'false', // 是否显示所有人的会话
     temporary_chat: isTemporary ? 'true' : 'false', //默认启用临时聊天
     show_userinfo: isAdmin ? 'true' : 'false',  // 是否显示用户信息
     reset_limit: 'false' // 是否重置对话限制
 }).toString();
 const apiResponse = await fetch(url, {
     method: 'POST',
     headers: {
         'Content-Type': 'application/x-www-form-urlencoded'
     },
     body: body
 });
 const responseText = await apiResponse.text();
 const tokenKeyMatch = /"token_key":"([^"]+)"/.exec(responseText);
 const tokenKey = tokenKeyMatch ? tokenKeyMatch[1] : 'Can not get share token.';
 return tokenKey;
}


async function handleLogin(userName, initialaccountNumber, turnstileResponse,anissues) {
//Turnsile认证
if (turnstileResponse !== 'do not need Turnstle' && (!turnstileResponse || !await verifyTurnstile(turnstileResponse))) {
   return generateLoginResponse('Turnstile verification failed');
}
const proxiedDomain = await KV.get('WorkerURL');
const status = await KV.get('Status');
const GPTState = await getGPTStatus();
if ((GPTState == 'major_performance')&&(!status)){
  await loginlog(userName, 'Bad_OAIStatus','Error');
  return generateLoginResponse(`OpenAI service is under maintenance.<br>Official status: ${GPTState} <br>More details: https://status.openai.com`);
}

 //先尝试json
 try {
     const tokenData = JSON.parse(userName);
     if (tokenData.accessToken) {
      const jsonAccessToken = tokenData.accessToken;
      const shareToken = await getShareToken('atdirect', jsonAccessToken, '0');
      if (shareToken === 'Can not get share token.') {
       return generateLoginResponse('Error fetching share token.');
     }
   
     return Response.redirect(await getOAuthLink(shareToken, proxiedDomain), 302);
    }
   } catch (e) {
     // 输入不是 JSON 格式
   }

// 如果输入用户名长度大于50，直接视作accessToken
if (userName.length > 50) {
 const shareToken = await getShareToken('atdirect', userName, '0');

 if (shareToken === 'Can not get share token.') {
   return generateLoginResponse('Error fetching share token.');
 }

 return Response.redirect(await getOAuthLink(shareToken, proxiedDomain), 302);
}


// 如果输入用户名fk开头，直接视作sharetoken
if (userName.startsWith('fk-')) {
 const shareToken = userName;
 return Response.redirect(await getOAuthLink(shareToken, proxiedDomain), 302);
}

 const userRegex = new RegExp(`^${userName}_(\\d+)$`);
 let fullUserName = userName;
 let foundSuffix = false;
 let suffix = '';
 const forcean = await KV.get("ForceAN");
  const defaultusers = await KV.get("Users")|| '';
  const vipusers = await KV.get("VIPUsers")|| '';
  const freeusers = await KV.get("FreeUsers")|| '';
  const admin = await KV.get("Admin")|| '';
  // 合并所有用户
  const users = `${defaultusers},${vipusers},${freeusers},${admin}`;


 // 自动查找匹配的用户名格式abc_xxx，并添加后缀
 users.split(",").forEach(user => {
   const match = user.match(userRegex);
       if (match) {
           foundSuffix = true;
           suffix = match[1];  // 更新后缀为实际的账号编号
           fullUserName = user; // 更新为完整的用户名
       }
   });
    
if (!foundSuffix && !users.split(",").includes(userName)) {
   await loginlog(userName, 'Bad_PW','Error');
   return generateLoginResponse('Unauthorized access.');
}

  
 //用户权限判断，仅在users库内的用户可使用所有车(前置已判断，不过也不用删)
 if (!users.split(",").includes(fullUserName)) {
     await loginlog(userName, 'Bad_PW','Error');
     return generateLoginResponse('Unauthorized access.');
 }
 //禁止免费用户使用序号大于99的vip私享车
// if (freeusers.split(",").includes(fullUserName) && accountNumber > 99) {
//     return new Response('Unauthorized access, you are vip users.', { status: 200 });
// }
 //禁止付费用户使用序号小于99的免费车
 //if (vipusers.split(",").includes(fullUserName) && accountNumber < 100) {
 //    return new Response('Unauthorized access, please switch accounts.', { status: 200 });
 //}


 //此处决定an
  const setan = await KV.get('SetAN');
  let antype = 'Plus';
  let mode = '';
  let accountNumber = '';

   // 如果 forcean 为 1，忽略用户输入的 accountNumber，使用后缀作为 accountNumber
if (foundSuffix && forcean === '1') {
 accountNumber = await getAccountNumber(fullUserName,suffix, antype, 'Check',anissues);
} else {
if (setan == 'True') {
  const plusmode = await KV.get('PlusMode'); //Random/Order
  const freemode = await KV.get('FreeMode'); //Plus/Random/Order
     antype = 'Plus';
     mode = plusmode;
 if (freemode !=='Plus'){
    if (freeusers.split(",").includes(fullUserName) ){
     antype = 'Free';
     mode = freemode;
     }
 }
 
accountNumber = await getAccountNumber(fullUserName,initialaccountNumber, antype, mode,anissues);
}
else if (setan)  {
 accountNumber = await getAccountNumber(fullUserName,setan, antype, 'Check',anissues);
}
else {
accountNumber = await getAccountNumber(fullUserName,initialaccountNumber, antype, 'Check',anissues);
}
}


 const refreshTokenKey = `rt_${accountNumber}`;
 const accessTokenKey = `at_${accountNumber}`;
 const accessToken = await KV.get(accessTokenKey);

 //使用佬友的sharetoken
 if (accessToken){
 if (accessToken.startsWith('fk-')) {
   const fkDomain = await KV.get('FKDomain') ||proxiedDomain;
   //return Response.redirect(await getOAuthLink(accessToken, fkDomain), 302);
   return Response.redirect(`https://${fkDomain}/auth/login_share?token=${accessToken}`)
 }}
 
 if (isTokenExpired(accessToken)) {
      // 给没有refresh token的萌新用（比如我），取消下面这行注释即可享用
     // return generateLoginResponse('The current access token has not been updated.', false);
      
      // 如果 Token 过期，执行获取新 Token 的逻辑
      const url = 'https://token.oaifree.com/api/auth/refresh';
     const refreshToken = await KV.get(refreshTokenKey);
     if (refreshToken) {

      // 发送 POST 请求
     const response = await fetch(url, {
         method: 'POST',
         headers: {
             'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
         },
         body: `refresh_token=${refreshToken}`
     });
    
     // 检查响应状态
     if (response.ok) {
         const data = await response.json();
         const newAccessToken = data.access_token;
         await KV.put(accessTokenKey, newAccessToken);
     } else {
         await KV.put(accessTokenKey, "Bad_RT");
         await loginlog(fullUserName, `Bad RT_${accountNumber}`,'Error');
         return generateLoginResponse('Error fetching access token.');
     }
 } 
 else {
   return generateLoginResponse('The current access token has not been updated.');
 }
 }   
     const finalaccessToken = await KV.get(accessTokenKey);
 const shareToken = await getShareToken(fullUserName, finalaccessToken,accountNumber);

 
 if (shareToken === 'Can not get share token.') {
     //await KV.put(accessTokenKey, "Bad_AT");
     await loginlog(fullUserName, `Bad AT_${accountNumber}`,'Error');
     return generateLoginResponse('Error fetching share token.');
 }

 
  // Log the successful login
  await loginlog(fullUserName, accountNumber, antype);

  const oauthLink = await getOAuthLink(shareToken, proxiedDomain);
       const headers = new Headers();
     headers.append('Location', oauthLink);
     headers.append('Set-Cookie', `aian=${accountNumber}; Path=/`);
     headers.append("Set-Cookie", `userName=${fullUserName}; Path=/`);
     
       const response = new Response(null, {
           status: 302,
           headers: headers
       });
       return response;
}

async function loginlog(userName, accountNumber, antype) {
 const currentTime = new Date().toLocaleString("zh-CN", { timeZone: "Asia/Shanghai" });
 const timestamp = Date.now();
 const logEntry = {
     user: userName,
     accountNumber: accountNumber,
     time: currentTime,
     timestamp: timestamp
 };
 // Retrieve the existing log array or create a new one if it doesn't exist
 const lastLoginLogs = await KV.get(`${antype}LoginLogs`);
 let logArray = [];
 if (lastLoginLogs) {
     logArray = JSON.parse(lastLoginLogs);
 }
 logArray.push(logEntry);
 await KV.put(`${antype}LoginLogs`, JSON.stringify(logArray));
}

async function deletelog(userName, accountNumber,antype) {
 const currentTime = new Date().toLocaleString("zh-CN", { timeZone: "Asia/Shanghai" });
 const logEntry = {
     user: userName,
     time: currentTime,
     accountNumber: accountNumber
 };
 // Retrieve the existing log array or create a new one if it doesn't exist
 const lastDeleteLogs = await KV.get(`${antype}DeleteLogs`);
 let logArray = [];
 if (lastDeleteLogs) {
     logArray = JSON.parse(lastDeleteLogs);
 }
 logArray.push(logEntry);
 await KV.put(`${antype}DeleteLogs`, JSON.stringify(logArray));
}

//AN获取和删除
async function getAccountNumber(userName, initialaccountNumber, antype, mode, anissues) {
 const currentTime = Date.now()
 const Milliseconds = 3 * 60 * 1000;
 
 const checkAndRemoveIssueAccount = async (accountNumber) => {
   // Retrieve the login logs
   const lastLoginLogs = await KV.get(`${antype}LoginLogs`);
   if (lastLoginLogs) {
     const logArray = JSON.parse(lastLoginLogs);
     const userLogs = logArray.filter(log => log.user === userName && log.accountNumber === accountNumber);
     if (userLogs.length > 0) {
       const recentLogins = userLogs.filter(log => {
         const logTime = log.timestamp;
         return currentTime - logTime <= Milliseconds;
       });
       if (recentLogins.length >= 1 && anissues) {
         // 删除问题账号
         const aliveAccount = await KV.get(`${antype}AliveAccounts`);
         let aliveAccountList = aliveAccount.split(',');
         aliveAccountList = aliveAccountList.filter(acc => acc !== accountNumber.toString());
         await KV.put(`${antype}AliveAccounts`, aliveAccountList.join(','));
         await deletelog(userName, accountNumber,antype);
         return true;
       }
     }
   }
   return false;
 };

 // 顺序读取
 if (mode == 'Order') {
   const aliveAccountString = await KV.get(`${antype}AliveAccounts`) || '';
   let aliveAccounts = aliveAccountString
     .split(',')
     .map(num => parseInt(num, 10))
     .filter(num => !isNaN(num));

   if (aliveAccounts.length > 0) {
     let minAccount = Math.min(...aliveAccounts);
     if (await checkAndRemoveIssueAccount(minAccount)) {
       aliveAccounts = aliveAccounts.filter(acc => acc !== minAccount);
       minAccount = aliveAccounts.length > 0 ? Math.min(...aliveAccounts) : 1;
     }
     return minAccount;
   }
   return 1;
 }

 // 检测和删除问题账号
 if (mode == 'Check') {
   await checkAndRemoveIssueAccount(initialaccountNumber);
   return initialaccountNumber;
 }

 // 随机读取
 if (mode == 'Random') {
   // Retrieve the last login logs
   const lastLoginLogs = await KV.get(`${antype}LoginLogs`);
   if (lastLoginLogs) {
     const logArray = JSON.parse(lastLoginLogs);
     const userLogs = logArray.filter(log => log.user === userName);
     const recentLogins = userLogs.filter(log => {
       const logTime = log.timestamp;
       return currentTime - logTime <= Milliseconds;
     });

     if (recentLogins.length > 0) {
       const lastAccount = recentLogins[recentLogins.length - 1].accountNumber;
       if (await checkAndRemoveIssueAccount(lastAccount)) {
         const aliveAccountString = await KV.get(`${antype}AliveAccounts`) || '';
         const aliveAccounts = aliveAccountString
           .split(',')
           .map(num => parseInt(num, 10))
           .filter(num => !isNaN(num));

         if (aliveAccounts.length > 0) {
           const randomAccount = aliveAccounts[Math.floor(Math.random() * aliveAccounts.length)];
           return randomAccount;
         }
         return 0;
       }
       return lastAccount;
     }
   }
   const aliveAccountString = await KV.get(`${antype}AliveAccounts`) || '';
   let aliveAccounts = aliveAccountString
     .split(',')
     .map(num => parseInt(num, 10))
     .filter(num => !isNaN(num));

   if (aliveAccounts.length > 0) {
     let randomAccount = aliveAccounts[Math.floor(Math.random() * aliveAccounts.length)];
     if (await checkAndRemoveIssueAccount(randomAccount)) {
       aliveAccounts = aliveAccounts.filter(acc => acc !== randomAccount);
       if (aliveAccounts.length > 0) {
         randomAccount = aliveAccounts[Math.floor(Math.random() * aliveAccounts.length)];
         return randomAccount;
       }
       return 0;
     }
     return randomAccount;
   }
   return 0;
 }

 return initialaccountNumber;
}



async function generateLoginResponse(message) {
 const setan = await KV.get('SetAN');
   const errorHtml = `
   <div class="ulp-field ulp-error">
     <div class="ulp-error-info">
       <span class="ulp-input-error-icon" role="img" aria-label="Error"></span>
       ${message}
     </div>
   </div>
   `;
   const html = await getLoginHTML(setan);
   const responseHtml = html.replace(
     '<button class="continue-btn" type="submit">Continue</button>',
     errorHtml + '<button class="continue-btn" type="submit">Continue</button>'
   );
   return new Response(responseHtml, { headers: { 'Content-Type': 'text/html' } });
 }
 
async function getAliveAccountOptions() {
   const plusAliveAccountString = await KV.get('PlusAliveAccounts') || '';
   const freeAliveAccountString = await KV.get('FreeAliveAccounts') || '';
   const aliveAccountString = `${plusAliveAccountString},${freeAliveAccountString}`.replace(/^,|,$/g, '');
   const aliveAccounts = aliveAccountString
     .split(',')
     .map(num => parseInt(num, 10))
     .filter(num => !isNaN(num));
 
   return aliveAccounts.map(num => `<option value="${num}">${num}</option>`).join('');
 }

 async function getGPTStatus(){
  const url = 'https://status.openai.com/api/v2/summary.json';
  

   // 发送 POST 请求
  const response = await fetch(url, {
      method: 'GET',
      headers: {
          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      },
  });
  // 检查响应状态
  if (response.ok) {
      const data = await response.json();
      const status = data.components.find((component) => component.name === 'ChatGPT');
      //return JSON.stringify(status);
      return status.status;
 }
 else {return 'operational';}
}


async function getLoginHTML(setan) {
  const WorkerURL=await KV.get('WorkerURL');
  const turnstileSiteKey=await KV.get('TurnstileSiteKey');
  const websiteName = await KV.get('WebName') || 'Haibara AI';
  const logourl = await KV.get('LogoURL') || logo;
  const removeTurnstile = await KV.get('RemoveTurnstile')||'';
   const commonHTML = `
     <!DOCTYPE html>
     <html lang="en">
     <head>
         <meta charset="UTF-8">
         <link rel="apple-touch-icon" sizes="180x180" href="https://cdn1.oaifree.com/_next/static/media/apple-touch-icon.82af6fe1.png"/>
         <link rel="icon" type="image/png" sizes="32x32" href="https://cdn4.oaifree.com/_next/static/media/favicon-32x32.630a2b99.png"/>
         <link rel="icon" type="image/png" sizes="16x16" href="https://cdn4.oaifree.com/_next/static/media/favicon-16x16.a052137e.png"/>
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>Login - ${websiteName}</title>
         <style>
             @charset "UTF-8";
             .oai-header img {
                 height: auto;
                 width: 128px;
                 margin-top: 50px;
             }
 
             a {
                 font-weight: 400;
                 text-decoration: inherit;
                 color: #10a37f;
             }
 
             .main-container {
                 flex: 1 0 auto;
                 min-height: 0;
                 display: grid;
                 box-sizing: border-box;
                 grid-template-rows: [left-start center-start right-start] 1fr [left-end center-end right-end];
                 grid-template-columns: [left-start center-start] 1fr [left-end right-start] 1fr [center-end right-end];
                 align-items: center;
                 justify-content: center;
                 justify-items: center;
                 grid-column-gap: 160px;
                 column-gap: 160px;
                 padding: 80px;
                 width: 100%;
             }
 
             .login-container {
                 background-color: #fff;
                 padding: 0 40px 40px;
                 border-radius: 3px;
                 box-shadow: none;
                 width: 320px;
                 box-sizing: content-box;
                 flex-shrink: 0;
             }
 
             .title-wrapper {
                 padding: 0 40px 24px;
                 box-sizing: content-box;
                 text-align: center;
             }
 
             .title {
                 font-size: 32px;
                 font: 'Söhne';
                 margin: 0;
                 color: #2d333a;
                 width: 320px;
             }
 
             .input-wrapper {
                 position: relative;
                 margin-bottom: 10px;
                 width: 320px;
                 box-sizing: content-box;
             }
 
             .email-input {
                 -webkit-appearance: none;
                 -moz-appearance: none;
                 appearance: none;
                 background-color: #fff;
                 border: 1px solid #c2c8d0;
                 border-radius: 6px;
                 box-sizing: border-box;
                 color: #2d333a;
                 font-family: inherit;
                 font-size: 16px;
                 height: 52px;
                 line-height: 1.1;
                 outline: none;
                 padding-block: 1px;
                 padding-inline: 2px;
                 padding: 0 16px;
                 transition:
                     box-shadow 0.2s ease-in-out,
                     border-color 0.2s ease-in-out;
                 width: 100%;
                 text-rendering: auto;
                 letter-spacing: normal;
                 word-spacing: normal;
                 text-transform: none;
                 text-indent: 0px;
                 text-shadow: none;
                 display: inline-block;
                 text-align: start;
                 margin: 0;
             }
 
             .email-input:focus,
             .email-input:valid {
                 border: 1px solid #10a37f;
                 outline: none;
             }
 
             .email-input:focus-within {
                 box-shadow: 1px #10a37f;
             }
 
             .email-input:focus + .email-label,
             .email-input:valid + .email-label {
                 font-size: 14px;
                 top: 0;
                 left: 10px;
                 color: #10a37f;
                 background-color: #fff;
             }
 
             .email-label {
                 position: absolute;
                 top: 26px;
                 left: 16px;
                 background-color: #fff;
                 color: #6f7780;
                 font-size: 16px;
                 font-weight: 400;
                 margin-bottom: 8px;
                 max-width: 90%;
                 overflow: hidden;
                 pointer-events: none;
                 padding: 1px 6px;
                 text-overflow: ellipsis;
                 transform: translateY(-50%);
                 transform-origin: 0;
                 transition:
                     transform 0.15s ease-in-out,
                     top 0.15s ease-in-out,
                     padding 0.15s ease-in-out;
                 white-space: nowrap;
                 z-index: 1;
             }
 
             .continue-btn {
                 position: relative;
                 height: 52px;
                 width: 320px;
                 background-color: #10a37f;
                 color: #fff;
                 margin: 10px 0 0;
                 align-items: center;
                 justify-content: center;
                 display: flex;
                 border-radius: 6px;
                 padding: 4px 16px;
                 font: inherit;
                 border-width: 0px;
                 cursor: pointer;
             }
 
             .continue-btn:hover {
                 box-shadow: inset 0 0 0 150px #0000001a;
             }
 
             :root {
                 font-family:
                     Söhne,
                     -apple-system,
                     BlinkMacSystemFont,
                     Helvetica,
                     sans-serif;
                 line-height: 1.5;
                 font-weight: 400;
                 font-synthesis: none;
                 text-rendering: optimizeLegibility;
                 -webkit-font-smoothing: antialiased;
                 -moz-osx-font-smoothing: grayscale;
             }
 
             .page-wrapper {
                 display: flex;
                 flex-direction: column;
                 justify-content: space-between;
                 min-height: 100%;
             }
 
             .oai-header {
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 width: 100%;
                 background-color: #fff;
             }
 
             body {
                 background-color: #fff;
                 display: block;
                 margin: 0;
             }
 
             .content-wrapper {
                 display: flex;
                 flex-direction: column;
                 align-items: center;
                 justify-content: center;
                 width: 100%;
                 height: auto;
                 white-space: normal;
                 border-radius: 5px;
                 position: relative;
                 grid-area: center;
                 box-shadow: none;
                 vertical-align: baseline;
                 box-sizing: content-box;
             }
 
             .checkbox-wrapper {
                 margin: 20px 0;
                 display: flex;
                 align-items: center;
             }
 
             .checkbox-label {
                 margin-left: 8px;
                 font-weight: 600;
                 color: #6f7780;
                 font-size: 14px;
             }
 
             .help-icon {
                 display: inline-block;
                 margin-left: 5px;
                 color: #10a37f;
                 cursor: pointer;
                 font-weight: bold;
             }
 
             .tooltip {
                 visibility: hidden;
                 min-width: 140px;
                 max-width: 300px;
                 line-height: 20px; 
                 min-height: 90px; 
                 display: flex;
                 align-items: center;
                 justify-content: center;
                 background-color: black;
                 color: #fff;
                 text-align: center;
                 border-radius: 6px;
                 
                 position: absolute;
                 z-index: 1;
                 bottom: 150%;
                 left: 50%;
                 margin-left: -70px; /* Half of the width to center the tooltip */
                 opacity: 0;
                 transition: opacity 0.3s, visibility 0.3s ease-in-out;
             }
 
             .tooltip::after {
                 content: "";
                 position: absolute;
                 top: 100%;
                 left: 50%;
                 margin-left: -5px;
                 border-width: 5px;
                 border-style: solid;
                 border-color: black transparent transparent transparent;
             }
 
             .field-container {
                 display: flex;
                 margin-bottom: 20px;
                 width: 320px;
                 box-sizing: content-box;
             }
 
             .field-container select {
                 flex: 3;
                 padding: 12px;
                 border: 1px solid #c2c8d0;
                 border-radius: 6px 0 0 6px;
                 font-size: 16px;
             }
 
             .field-container input[type="number"] {
                 flex: 1;
                 padding: 12px;
                 border: 1px solid #c2c8d0;
                 border-radius: 0 6px 6px 0;
                 font-size: 16px;
             }
 
             .cf-turnstile {
                 display: flex;
                 justify-content: center;
                 margin-top: 10px;
             }
             .other-page {
                 text-align: center;
                 margin-top: 14px;
                 margin-bottom: 0;
                 font-size: 14px;
                 width: 320px;
                 }
                 .divider-wrapper {
                     display: flex;
                     flex-direction: row;
                     text-transform: uppercase;
                     border: none;
                     font-size: 12px;
                     font-weight: 400;
                     margin: 0;
                     padding: 24px 0 0;
                     align-items: center;
                     justify-content: center;
                     width: 320px;
                     vertical-align: baseline;
                     }
                     
                     .divider-wrapper:before {
                         content: "";
                         border-bottom: 1px solid #c2c8d0;
                         flex: 1 0 auto;
                         height: .5em;
                         margin:0
                     }
                      .divider-wrapper:after{
                         content: "";
                         border-bottom: 1px solid #c2c8d0;
                         flex: 1 0 auto;
                         height: .5em;
                         margin:0
                     }
                     .divider {
                         text-align: center;
                         flex: .2 0 auto;
                         margin: 0;
                         height:12px
                     }
                     .checkbox-wrapper {
                         margin: 0px 0;
                         display: flex;
                         align-items: center;
                     }
                     .checkbox-label {
                         margin-left: 8px;
                         font-weight: 400;
                         color: #6f7780;
                         font-size: 14px;
                     }
                     .ulp-field.ulp-error .ulp-error-info {
                       margin-top: 4px;
                       margin-bottom: 4px;
                       display: flex;
                       font-size: 14px;
                       line-height: 1.4;
                       text-align: left;
                       color: #d00e17;
                   }
                   
                   .ulp-input-error-icon {
                       margin-right: 4px;
                   }
                   .ulp-input-error-icon::before {
                       content: "🚫";
                       margin-right: 0px;
                     }
                     .footer {
                      text-align: center;
                      font-size: 12px;
                      padding: 10px;
                  }
          
                  .footer a {
                      color: black;
                      text-decoration: none;
                  }
          
                  .footer a:hover {
                      text-decoration: none;
                      color: black;
                  }
      
             
         </style>
     </head>
     <body>
         <div id="root">
             <div class="page-wrapper">
                 <header class="oai-header">
                     <a href="https://${WorkerURL}/admin">
                         <img src="${logourl}" alt="Logo">
                     </a>
                 </header>
                 <main class="main-container">
                     <section class="content-wrapper">
                         <div class="title-wrapper"><h1 class="title">${websiteName}</h1></div>
                         <div class="login-container">
                             <form id="manageAccountForm0" action="/auth/login_auth0" method="POST">
                                 <div class="input-wrapper">
                                     <input
                                         class="email-input"
                                         inputmode="email"
                                         type="text"
                                         id="un"
                                         name="un"
                                         autocomplete="username"
                                         autocapitalize="none"
                                         spellcheck="false"
                                         required
                                         placeholder=" "
                                     />
                                     <label class="email-label" for="un">Username</label>
                                 </div>`;
 
   const aliveAccountOptions = await getAliveAccountOptions();
 
   const accountNumberHTML = `
                                 <div class="input-wrapper">
                                     <label for="an">
                                         <a class="username-label" href="https://${WorkerURL}/token">Account Number:</a>
                                         <span class="help-icon">?</span>
                                     </label>
                                     <div class="field-container">
                                         <select id="an" name="an" class="email-input">
                                             ${aliveAccountOptions}
                                         </select>
                                         <input type="number" id="an-custom" name="an-custom" class="email-input" placeholder="Enter number">
                                     </div>
                                 </div>`;
 
   const commonHTML2 = `
                                 <div class="checkbox-wrapper">
                                     <input type="checkbox" id="an-issues" name="anissues" />
                                     <label class="checkbox-label" for="an-issues">Report Account Issues</label>
                                 </div>
                                 <button class="continue-btn" type="submit">Continue</button>
                                 <input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response" required>
                                 <div class="cf-turnstile" data-sitekey="${turnstileSiteKey}" data-callback="onTurnstileCallback"></div>
                             </form>
                             <div class="divider-wrapper"><span class="divider">Or</span></div>
                             <p class="other-page">Don't have an account? <a class="other-page-link" href="https://${WorkerURL}/register">Sign Up</a></p>
                         </div>
                     </section>
                 </main>
             </div>
         </div>
         <footer class="footer">
                <p>&copy; All rights reserved. | Powered by <a href="https://linux.do" target="_blank">Pandora</a> & <a href="https://chatgpt.com" target="_blank">ChatGPT</a></p>
            </footer>
            
         <script>
         if ('${removeTurnstile}') {
       document.getElementById('cf-turnstile-response').value= "111";
      }
             document.addEventListener('DOMContentLoaded', function() {
                 const helpIcon = document.querySelector('.help-icon');
                 const tooltip = document.createElement('div');
                 tooltip.className = 'tooltip';
                 tooltip.textContent = 'Select your account. Chat histories are not shared between accounts. Other users cannot view your chat history.';
                 document.body.appendChild(tooltip);
 
                 helpIcon.addEventListener('mouseover', function() {
                     tooltip.style.visibility = 'visible';
                     tooltip.style.opacity = '1';
                     const rect = helpIcon.getBoundingClientRect();
                     tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
                     tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
                 });
 
                 helpIcon.addEventListener('mouseout', function() {
                     tooltip.style.visibility = 'hidden';
                     tooltip.style.opacity = '0';
                 });
             });
 
             function onTurnstileCallback(token) {
                 document.getElementById('cf-turnstile-response').value = token;
             }
 
             document.getElementById('manageAccountForm0').addEventListener('submit', function(event) {
                 if (!document.getElementById('cf-turnstile-response').value) {
                     alert('Please complete the verification.');
                     event.preventDefault();
                 }
             });
         </script>
         <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
     </body>
     </html>`;
 
   return setan ? commonHTML + commonHTML2 : commonHTML + accountNumberHTML + commonHTML2;
 }
